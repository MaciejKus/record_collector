(function(p,k){"function"!=typeof Object.defineProperty&&(Object.defineProperty=function(a,c,h){return"value" in h&&(a[c]=h.value),"get" in h&&a.__defineGetter__(c,h.get),"set" in h&&a.__defineSetter__(c,h.set),a}),"function"!=typeof Object.defineProperties&&(Object.defineProperties=function(a,c){for(var h in c){c.hasOwnProperty(h)&&Object.defineProperty(a,h,c[h])}return a}),"function"!=typeof Object.create&&(Object.create=function(c,h){function o(){}o.prototype=c;var a=new o;return null!=h&&Object.defineProperties(a,h),a}),"function"!=typeof Object.getPrototypeOf&&(Object.getPrototypeOf=function(a){return a.__proto__}),"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(o){var t=this,a=Array.prototype.slice.call(arguments,1),c=function(){},h=function(){var e=a.concat(Array.prototype.slice.call(arguments));return t.apply(this instanceof c?this:o||p,e)};return c.prototype=t.prototype,h.prototype=new c,h}),p.getTime=function(){var a;return p.performance&&p.performance.now?(a=Date.now(),function(){return a+p.performance.now()}):p.performance&&p.performance.webkitNow?(a=Date.now(),function(){return a+p.performance.webkitNow()}):Date.now}(),p.requestAnimationFrame=p.requestAnimationFrame||p.mozRequestAnimationFrame||p.webkitRequestAnimationFrame||p.msRequestAnimationFrame||function(){var a=p.getTime(),c=1000/60;return function(e){var h=setTimeout(function(){a=p.getTime(),e(a)},Math.max(0,a+c-p.getTime()));return h}}();var f=function(c){if(null!=c&&(c instanceof Array||(c=Array.prototype.slice.call(arguments)),c=c.filter(function(e){return[e].join()})),function a(w,t){var u,e,v=[];for(var i in w){w.hasOwnProperty(i)&&("function"==typeof w[i]?p[i]=w[i]:"object"==typeof w[i]&&null!==w[i]&&Object.getPrototypeOf(w[i])===Object.prototype&&(null==c?v.push(i):(u=c.indexOf(t+i),-1!==u&&(v.push(i),c.splice(u,1)))))}for(u=0,e=v.length;e>u;u++){a(w[v[u]],t+v[u]+".")}}(f,""),f.Class.getInheritanceTree(p.Game).length<=f.Class.getInheritanceTree(p.Core).length&&(p.Game=p.Core),null!=c&&c.length){throw Error("Cannot load module: "+c.join(", "))}};p.enchant=f,p.addEventListener("message",function(c){try{var h=JSON.parse(c.data);if("event"===h.type){f.Core.instance.dispatchEvent(new f.Event(h.value))}else{if("debug"===h.type){switch(h.value){case"start":f.Core.instance.start();break;case"pause":f.Core.instance.pause();break;case"resume":f.Core.instance.resume();break;case"tick":f.Core.instance._tick();break;default:}}}}catch(a){}},!1),f.Class=function(a,c){return f.Class.create(a,c)},f.Class.create=function(n,e){if(null==n&&e){throw Error("superclass is undefined (enchant.Class.create)")}if(null==n){throw Error("definition is undefined (enchant.Class.create)")}if(0===arguments.length){return f.Class.create(Object,e)}if(1===arguments.length&&"function"!=typeof arguments[0]){return f.Class.create(Object,arguments[0])}for(var v in e){e.hasOwnProperty(v)&&("object"==typeof e[v]&&null!==e[v]&&Object.getPrototypeOf(e[v])===Object.prototype?"enumerable" in e[v]||(e[v].enumerable=!0):e[v]={value:e[v],enumerable:!0,writable:!0})}var w=function(){return this instanceof w?(w.prototype.initialize.apply(this,arguments),k):new w};w.prototype=Object.create(n.prototype,e),w.prototype.constructor=w,null==w.prototype.initialize&&(w.prototype.initialize=function(){n.apply(this,arguments)});for(var c=this.getInheritanceTree(n),x=0,u=c.length;u>x;x++){if("function"==typeof c[x]._inherited){c[x]._inherited(w);break}}return w},f.Class.getInheritanceTree=function(c){for(var h=[],o=c,a=o.prototype;o!==Object;){h.push(o),a=Object.getPrototypeOf(a),o=a.constructor}return h},f.ENV={VERSION:"0.6.1",VENDOR_PREFIX:function(){var a=navigator.userAgent;return -1!==a.indexOf("Opera")?"O":-1!==a.indexOf("MSIE")?"ms":-1!==a.indexOf("WebKit")?"webkit":"Gecko"===navigator.product?"Moz":""}(),TOUCH_ENABLED:function(){var a=document.createElement("div");return a.setAttribute("ontouchstart","return"),"function"==typeof a.ontouchstart}(),RETINA_DISPLAY:function(){if(-1!==navigator.userAgent.indexOf("iPhone")&&2===p.devicePixelRatio){var a=document.querySelector('meta[name="viewport"]');return null==a&&(a=document.createElement("meta"),document.head.appendChild(a)),a.setAttribute("content","width=640"),!0}return !1}(),USE_FLASH_SOUND:function(){var a=navigator.userAgent,c=navigator.vendor||"";return 0===location.href.indexOf("http")&&-1===a.indexOf("Mobile")&&-1!==c.indexOf("Apple")}(),USE_DEFAULT_EVENT_TAGS:["input","textarea","select","area"],CANVAS_DRAWING_METHODS:["putImageData","drawImage","drawFocusRing","fill","stroke","clearRect","fillRect","strokeRect","fillText","strokeText"],KEY_BIND_TABLE:{37:"left",38:"up",39:"right",40:"down"},PREVENT_DEFAULT_KEY_CODES:[37,38,39,40,32],SOUND_ENABLED_ON_MOBILE_SAFARI:!1,USE_WEBAUDIO:function(){return"file:"!==location.protocol}(),USE_ANIMATION:!0},f.Event=f.Class.create({initialize:function(a){this.type=a,this.target=null,this.x=0,this.y=0,this.localX=0,this.localY=0},_initPosition:function(c,h){var a=f.Core.instance;this.x=this.localX=(c-a._pageX)/a.scale,this.y=this.localY=(h-a._pageY)/a.scale}}),f.Event.LOAD="load",f.Event.ERROR="error",f.Event.CORE_RESIZE="coreresize",f.Event.PROGRESS="progress",f.Event.ENTER_FRAME="enterframe",f.Event.EXIT_FRAME="exitframe",f.Event.ENTER="enter",f.Event.EXIT="exit",f.Event.CHILD_ADDED="childadded",f.Event.ADDED="added",f.Event.ADDED_TO_SCENE="addedtoscene",f.Event.CHILD_REMOVED="childremoved",f.Event.REMOVED="removed",f.Event.REMOVED_FROM_SCENE="removedfromscene",f.Event.TOUCH_START="touchstart",f.Event.TOUCH_MOVE="touchmove",f.Event.TOUCH_END="touchend",f.Event.RENDER="render",f.Event.INPUT_START="inputstart",f.Event.INPUT_CHANGE="inputchange",f.Event.INPUT_END="inputend",f.Event.INPUT_STATE_CHANGED="inputstatechanged",f.Event.LEFT_BUTTON_DOWN="leftbuttondown",f.Event.LEFT_BUTTON_UP="leftbuttonup",f.Event.RIGHT_BUTTON_DOWN="rightbuttondown",f.Event.RIGHT_BUTTON_UP="rightbuttonup",f.Event.UP_BUTTON_DOWN="upbuttondown",f.Event.UP_BUTTON_UP="upbuttonup",f.Event.DOWN_BUTTON_DOWN="downbuttondown",f.Event.DOWN_BUTTON_UP="downbuttonup",f.Event.A_BUTTON_DOWN="abuttondown",f.Event.A_BUTTON_UP="abuttonup",f.Event.B_BUTTON_DOWN="bbuttondown",f.Event.B_BUTTON_UP="bbuttonup",f.Event.ADDED_TO_TIMELINE="addedtotimeline",f.Event.REMOVED_FROM_TIMELINE="removedfromtimeline",f.Event.ACTION_START="actionstart",f.Event.ACTION_END="actionend",f.Event.ACTION_TICK="actiontick",f.Event.ACTION_ADDED="actionadded",f.Event.ACTION_REMOVED="actionremoved",f.EventTarget=f.Class.create({initialize:function(){this._listeners={}},addEventListener:function(a,c){var h=this._listeners[a];null==h?this._listeners[a]=[c]:-1===h.indexOf(c)&&h.unshift(c)},on:function(){this.addEventListener.apply(this,arguments)},removeEventListener:function(c,h){var o=this._listeners[c];if(null!=o){var a=o.indexOf(h);-1!==a&&o.splice(a,1)}},clearEventListener:function(a){null!=a?delete this._listeners[a]:this._listeners={}},dispatchEvent:function(c){c.target=this,c.localX=c.x-this._offsetX,c.localY=c.y-this._offsetY,null!=this["on"+c.type]&&this["on"+c.type](c);var h=this._listeners[c.type];if(null!=h){h=h.slice();for(var o=0,a=h.length;a>o;o++){h[o].call(this,c)}}}}),function(){var a;f.Core=f.Class.create(f.EventTarget,{initialize:function(v,C){if(null===p.document.body){throw Error("document.body is null. Please excute 'new Core()' in window.onload.")}f.EventTarget.call(this);var e=!0;a&&(e=!1,a.stop()),a=f.Core.instance=this,this._calledTime=0,this._mousedownID=0,this._surfaceID=0,this._soundID=0,this._scenes=[],v=v||320,C=C||320;var A,n,w,z=document.getElementById("enchant-stage");if(z){var y=p.getComputedStyle(z);for(n=parseInt(y.width,10),w=parseInt(y.height,10),A=n&&w?Math.min(n/v,w/C):1;z.firstChild;){z.removeChild(z.firstChild)}z.style.position="relative";var B=z.getBoundingClientRect();this._pageX=Math.round(p.scrollX||p.pageXOffset+B.left),this._pageY=Math.round(p.scrollY||p.pageYOffset+B.top)}else{z=document.createElement("div"),z.id="enchant-stage",z.style.position="absolute",document.body.firstChild?document.body.insertBefore(z,document.body.firstChild):document.body.appendChild(z),A=Math.min(p.innerWidth/v,p.innerHeight/C),this._pageX=z.getBoundingClientRect().left,this._pageY=z.getBoundingClientRect().top}z.style.fontSize="12px",z.style.webkitTextSizeAdjust="none",z.style.webkitTapHighlightColor="rgba(0, 0, 0, 0)",this._element=z,this.addEventListener("coreresize",this._oncoreresize),this._width=v,this._height=C,this.scale=A,this.fps=30,this.frame=0,this.ready=!1,this.running=!1,this.assets={},this._assets=[],function t(c){c.assets&&f.Core.instance.preload(c.assets);for(var h in c){c.hasOwnProperty(h)&&"object"==typeof c[h]&&null!==c[h]&&Object.getPrototypeOf(c[h])===Object.prototype&&t(c[h])}}(f),this.currentScene=null,this.rootScene=new f.Scene,this.pushScene(this.rootScene),this.loadingScene=new f.LoadingScene,this._activated=!1,this._offsetX=0,this._offsetY=0,this.input={},this.keyboardInputManager=new f.KeyboardInputManager(p.document,this.input),this.keyboardInputManager.addBroadcastTarget(this),this._keybind=this.keyboardInputManager._binds,f.ENV.KEY_BIND_TABLE||(f.ENV.KEY_BIND_TABLE={});for(var x in f.ENV.KEY_BIND_TABLE){this.keybind(x,f.ENV.KEY_BIND_TABLE[x])}e&&(z=f.Core.instance._element,document.addEventListener("keydown",function(c){a.dispatchEvent(new f.Event("keydown")),-1!==f.ENV.PREVENT_DEFAULT_KEY_CODES.indexOf(c.keyCode)&&(c.preventDefault(),c.stopPropagation())},!0),f.ENV.TOUCH_ENABLED&&(z.addEventListener("touchstart",function(h){var c=h.target.tagName.toLowerCase();-1===f.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(c)&&(h.preventDefault(),a.running||h.stopPropagation())},!0),z.addEventListener("touchmove",function(h){var c=h.target.tagName.toLowerCase();-1===f.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(c)&&(h.preventDefault(),a.running||h.stopPropagation())},!0),z.addEventListener("touchend",function(h){var c=h.target.tagName.toLowerCase();-1===f.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(c)&&(h.preventDefault(),a.running||h.stopPropagation())},!0)),z.addEventListener("mousedown",function(h){var c=h.target.tagName.toLowerCase();-1===f.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(c)&&(h.preventDefault(),a._mousedownID++,a.running||h.stopPropagation())},!0),z.addEventListener("mousemove",function(h){var c=h.target.tagName.toLowerCase();-1===f.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(c)&&(h.preventDefault(),a.running||h.stopPropagation())},!0),z.addEventListener("mouseup",function(h){var c=h.target.tagName.toLowerCase();-1===f.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(c)&&(h.preventDefault(),a.running||h.stopPropagation())},!0),a._touchEventTarget={},f.ENV.TOUCH_ENABLED&&(z.addEventListener("touchstart",function(D){for(var H,u,F=f.Core.instance,G=new f.Event(f.Event.TOUCH_START),c=D.changedTouches,I=0,E=c.length;E>I;I++){H=c[I],G._initPosition(H.pageX,H.pageY),u=F.currentScene._determineEventTarget(G),F._touchEventTarget[H.identifier]=u,u.dispatchEvent(G)}},!1),z.addEventListener("touchmove",function(D){for(var H,u,F=f.Core.instance,G=new f.Event(f.Event.TOUCH_MOVE),c=D.changedTouches,I=0,E=c.length;E>I;I++){H=c[I],u=F._touchEventTarget[H.identifier],u&&(G._initPosition(H.pageX,H.pageY),u.dispatchEvent(G))}},!1),z.addEventListener("touchend",function(D){for(var H,u,F=f.Core.instance,G=new f.Event(f.Event.TOUCH_END),c=D.changedTouches,I=0,E=c.length;E>I;I++){H=c[I],u=F._touchEventTarget[H.identifier],u&&(G._initPosition(H.pageX,H.pageY),u.dispatchEvent(G),delete F._touchEventTarget[H.identifier])}},!1)),z.addEventListener("mousedown",function(h){var r=f.Core.instance,c=new f.Event(f.Event.TOUCH_START);c._initPosition(h.pageX,h.pageY);var o=r.currentScene._determineEventTarget(c);r._touchEventTarget[r._mousedownID]=o,o.dispatchEvent(c)},!1),z.addEventListener("mousemove",function(h){var r=f.Core.instance,c=new f.Event(f.Event.TOUCH_MOVE);c._initPosition(h.pageX,h.pageY);var o=r._touchEventTarget[r._mousedownID];o&&o.dispatchEvent(c)},!1),z.addEventListener("mouseup",function(h){var r=f.Core.instance,c=new f.Event(f.Event.TOUCH_END);c._initPosition(h.pageX,h.pageY);var o=r._touchEventTarget[r._mousedownID];o&&o.dispatchEvent(c),delete r._touchEventTarget[r._mousedownID]},!1))},width:{get:function(){return this._width},set:function(c){this._width=c,this._dispatchCoreResizeEvent()}},height:{get:function(){return this._height},set:function(c){this._height=c,this._dispatchCoreResizeEvent()}},scale:{get:function(){return this._scale},set:function(c){this._scale=c,this._dispatchCoreResizeEvent()}},_dispatchCoreResizeEvent:function(){var c=new f.Event("coreresize");c.width=this._width,c.height=this._height,c.scale=this._scale,this.dispatchEvent(c)},_oncoreresize:function(h){this._element.style.width=Math.floor(this._width*this._scale)+"px",this._element.style.height=Math.floor(this._height*this._scale)+"px";for(var o,r=0,c=this._scenes.length;c>r;r++){o=this._scenes[r],o.dispatchEvent(h)}},preload:function(c){var h;if(!(c instanceof Array)){if("object"==typeof c){h=[];for(var i in c){c.hasOwnProperty(i)&&h.push([c[i],i])}c=h}else{c=Array.prototype.slice.call(arguments)}}return Array.prototype.push.apply(this._assets,c),this},load:function(n,e,v,w){var c,x;"string"==typeof arguments[1]?(c=e,x=1):(c=n,x=0),v=arguments[1+x]||function(){},w=arguments[2+x]||function(){};var u=f.Core.findExt(n);return f.Deferred.next(function(){var h=new f.Deferred,s=function(i){h.call(i),v.call(this,i)},t=function(i){h.fail(i),w.call(this,i)};if(f.Core._loadFuncs[u]){f.Core.instance.assets[c]=f.Core._loadFuncs[u](n,u,s,t)}else{var r=new XMLHttpRequest;r.open("GET",n,!0),r.onreadystatechange=function(){if(4===r.readyState){if(200!==r.status&&0!==r.status){var o=new f.Event("error");o.message=r.status+": Cannot load an asset: "+n,t.call(f.Core.instance,o)}var y=r.getResponseHeader("Content-Type")||"";y.match(/^image/)?a.assets[c]=f.Surface.load(n,s,t):y.match(/^audio/)?a.assets[c]=f.Sound.load(n,y,s,t):(a.assets[c]=r.responseText,s.call(f.Core.instance,new f.Event("laod")))}},r.send(null)}return h})},start:function(t){var A=function(){this.frame=0,this.removeEventListener("load",A)};if(this.addEventListener("load",A),this.currentTime=p.getTime(),this.running=!0,this.ready=!0,!this._activated&&(this._activated=!0,f.ENV.SOUND_ENABLED_ON_MOBILE_SAFARI&&!a._touched&&(-1!==navigator.userAgent.indexOf("iPhone OS")||-1!==navigator.userAgent.indexOf("iPad")))){var e=new f.Deferred,y=new f.Scene;y.backgroundColor="#000";var n=Math.round(a.width/10),v=new f.Sprite(a.width,n);v.y=(a.height-n)/2,v.image=new f.Surface(a.width,n),v.image.context.fillStyle="#fff",v.image.context.font=n-1+"px bold Helvetica,Arial,sans-serif";var x=v.image.context.measureText("Touch to Start").width;return v.image.context.fillText("Touch to Start",(a.width-x)/2,n-1),y.addChild(v),document.addEventListener("mousedown",function w(){document.removeEventListener("mousedown",w),a._touched=!0,a.removeScene(y),a.start(e)},!1),a.pushScene(y),e}this._requestNextFrame(0);var z=this._requestPreload().next(function(){f.Core.instance.loadingScene.dispatchEvent(new f.Event(f.Event.LOAD))});return t&&z.next(function(c){t.call(c)}).error(function(c){t.fail(c)}),z},_requestPreload:function(){var e={},c=0,h=0,n=function(){var i=new f.Event("progress");i.loaded=++c,i.total=h,a.loadingScene.dispatchEvent(i)};return this._assets.reverse().forEach(function(r){var s,o;r instanceof Array?(s=r[0],o=r[1]):s=o=r,e[o]||(e[o]=this.load(s,o,n),h++)},this),this.pushScene(this.loadingScene),f.Deferred.parallel(e)},debug:function(){return this._debug=!0,this.start()},actualFps:{get:function(){return this._actualFps||this.fps}},_requestNextFrame:function(c){this.ready&&(this.fps>=60||16>=c?(this._calledTime=p.getTime(),p.requestAnimationFrame(this._callTick)):setTimeout(function(){var h=f.Core.instance;h._calledTime=p.getTime(),p.requestAnimationFrame(h._callTick)},Math.max(0,c)))},_callTick:function(c){f.Core.instance._tick(c)},_tick:function(){var u=new f.Event("enterframe"),h=p.getTime(),n=u.elapsed=h-this.currentTime;this._actualFps=n>0?1000/n:0;for(var t=this.currentScene.childNodes.slice(),c=Array.prototype.push;t.length;){var v=t.pop();v.age++,v.dispatchEvent(u),v.childNodes&&c.apply(t,v.childNodes)}this.currentScene.age++,this.currentScene.dispatchEvent(u),this.dispatchEvent(u),this.dispatchEvent(new f.Event("exitframe")),this.frame++,h=p.getTime(),this.currentTime=h,this._requestNextFrame(1000/this.fps-(h-this._calledTime))},getTime:function(){return p.getTime()},stop:function(){this.ready=!1,this.running=!1},pause:function(){this.ready=!1},resume:function(){this.ready||(this.currentTime=p.getTime(),this.ready=!0,this.running=!0,this._requestNextFrame(0))},pushScene:function(c){return this._element.appendChild(c._element),this.currentScene&&this.currentScene.dispatchEvent(new f.Event("exit")),this.currentScene=c,this.currentScene.dispatchEvent(new f.Event("enter")),this._scenes.push(c)},popScene:function(){return this.currentScene===this.rootScene?this.currentScene:(this._element.removeChild(this.currentScene._element),this.currentScene.dispatchEvent(new f.Event("exit")),this.currentScene=this._scenes[this._scenes.length-2],this.currentScene.dispatchEvent(new f.Event("enter")),this._scenes.pop())},replaceScene:function(c){return this.popScene(),this.pushScene(c)},removeScene:function(c){if(this.currentScene===c){return this.popScene()}var h=this._scenes.indexOf(c);return -1!==h?(this._scenes.splice(h,1),this._element.removeChild(c._element),c):null},_buttonListener:function(c){this.currentScene.dispatchEvent(c)},keybind:function(c,h){return this.keyboardInputManager.keybind(c,h),this.addEventListener(h+"buttondown",this._buttonListener),this.addEventListener(h+"buttonup",this._buttonListener),this},keyunbind:function(c){var h=this._keybind[c];return this.keyboardInputManager.keyunbind(c),this.removeEventListener(h+"buttondown",this._buttonListener),this.removeEventListener(h+"buttonup",this._buttonListener),this},changeButtonState:function(c,h){this.keyboardInputManager.changeState(c,h)},getElapsedTime:function(){return this.frame/this.fps}}),f.Core._loadFuncs={},f.Core._loadFuncs.jpg=f.Core._loadFuncs.jpeg=f.Core._loadFuncs.gif=f.Core._loadFuncs.png=f.Core._loadFuncs.bmp=function(h,o,c,n){return f.Surface.load(h,c,n)},f.Core._loadFuncs.mp3=f.Core._loadFuncs.aac=f.Core._loadFuncs.m4a=f.Core._loadFuncs.wav=f.Core._loadFuncs.ogg=function(h,o,c,n){return f.Sound.load(h,"audio/"+o,c,n)},f.Core.findExt=function(c){var h=c.match(/\.\w+$/);return h&&h.length>0?h[0].slice(1).toLowerCase():0===c.indexOf("data:")?c.split(/[\/;]/)[1].toLowerCase():null},f.Core.instance=null}(),f.Game=f.Core,f.InputManager=f.Class.create(f.EventTarget,{initialize:function(a,c){f.EventTarget.call(this),this.broadcastTarget=[],this.valueStore=a,this.source=c||this,this._binds={},this._stateHandler=function(h){var i=h.source.identifier,o=this._binds[i];this.changeState(o,h.data)}.bind(this)},bind:function(a,c){a.addEventListener(f.Event.INPUT_STATE_CHANGED,this._stateHandler),this._binds[a.identifier]=c},unbind:function(a){a.removeEventListener(f.Event.INPUT_STATE_CHANGED,this._stateHandler),delete this._binds[a.identifier]},addBroadcastTarget:function(a){var c=this.broadcastTarget.indexOf(a);-1===c&&this.broadcastTarget.push(a)},removeBroadcastTarget:function(a){var c=this.broadcastTarget.indexOf(a);-1!==c&&this.broadcastTarget.splice(c,1)},broadcastEvent:function(c){for(var h=this.broadcastTarget,o=0,a=h.length;a>o;o++){h[o].dispatchEvent(c)}},changeState:function(){}}),f.InputSource=f.Class.create(f.EventTarget,{initialize:function(a){f.EventTarget.call(this),this.identifier=a},notifyStateChange:function(a){var c=new f.Event(f.Event.INPUT_STATE_CHANGED);c.data=a,c.source=this,this.dispatchEvent(c)}}),f.BinaryInputManager=f.Class.create(f.InputManager,{initialize:function(c,n,a,h){f.InputManager.call(this,c,h),this.activeInputsNum=0,this.activeEventNameSuffix=n,this.inactiveEventNameSuffix=a},bind:function(a,c){f.InputManager.prototype.bind.call(this,a,c),this.valueStore[c]=!1},unbind:function(a){f.InputManager.prototype.unbind.call(this,a);var c=this._binds[a.identifier];delete this.valueStore[c]},changeState:function(a,c){c?this._down(a):this._up(a)},_down:function(c){var h;this.valueStore[c]||(this.valueStore[c]=!0,h=new f.Event(this.activeInputsNum++?"inputchange":"inputstart"),h.source=this.source,this.broadcastEvent(h));var a=new f.Event(c+this.activeEventNameSuffix);a.source=this.source,this.broadcastEvent(a)},_up:function(c){var h;this.valueStore[c]&&(this.valueStore[c]=!1,h=new f.Event(--this.activeInputsNum?"inputchange":"inputend"),h.source=this.source,this.broadcastEvent(h));var a=new f.Event(c+this.inactiveEventNameSuffix);a.source=this.source,this.broadcastEvent(a)}}),f.BinaryInputSource=f.Class.create(f.InputSource,{initialize:function(a){f.InputSource.call(this,a)}}),f.KeyboardInputManager=f.Class.create(f.BinaryInputManager,{initialize:function(a,c){f.BinaryInputManager.call(this,c,"buttondown","buttonup"),this._attachDOMEvent(a,"keydown",!0),this._attachDOMEvent(a,"keyup",!1)},keybind:function(a,c){this.bind(f.KeyboardInputSource.getByKeyCode(""+a),c)},keyunbind:function(a){this.unbind(f.KeyboardInputSource.getByKeyCode(""+a))},_attachDOMEvent:function(c,h,a){c.addEventListener(h,function(i){var u=f.Core.instance;if(u&&u.running){var n=i.keyCode,o=f.KeyboardInputSource._instances[n];o&&o.notifyStateChange(a)}},!0)}}),f.KeyboardInputSource=f.Class.create(f.BinaryInputSource,{initialize:function(a){f.BinaryInputSource.call(this,a)}}),f.KeyboardInputSource._instances={},f.KeyboardInputSource.getByKeyCode=function(a){return this._instances[a]||(this._instances[a]=new f.KeyboardInputSource(a)),this._instances[a]},f.Node=f.Class.create(f.EventTarget,{initialize:function(){f.EventTarget.call(this),this._dirty=!1,this._matrix=[1,0,0,1,0,0],this._x=0,this._y=0,this._offsetX=0,this._offsetY=0,this.age=0,this.parentNode=null,this.scene=null,this.addEventListener("touchstart",function(a){this.parentNode&&this.parentNode.dispatchEvent(a)}),this.addEventListener("touchmove",function(a){this.parentNode&&this.parentNode.dispatchEvent(a)}),this.addEventListener("touchend",function(a){this.parentNode&&this.parentNode.dispatchEvent(a)}),f.ENV.USE_ANIMATION&&(this.tl=new f.Timeline(this))},moveTo:function(a,c){this._x=a,this._y=c,this._dirty=!0},moveBy:function(a,c){this._x+=a,this._y+=c,this._dirty=!0},x:{get:function(){return this._x},set:function(a){this._x=a,this._dirty=!0}},y:{get:function(){return this._y},set:function(a){this._y=a,this._dirty=!0}},_updateCoordinate:function(){var E=this,z=[E],x=E.parentNode;for(this.scene;x&&E._dirty;){z.unshift(x),E=E.parentNode,x=E.parentNode}var F,n,C,v=f.Matrix.instance,y=v.stack,B=[];y.push(z[0]._matrix);for(var A=1,D=z.length;D>A;A++){E=z[A],F=[],v.makeTransformMatrix(E,B),v.multiply(y[y.length-1],B,F),E._matrix=F,y.push(F),n="number"==typeof E._originX?E._originX:E._width/2||0,C="number"==typeof E._originY?E._originY:E._height/2||0;var w=[n,C];v.multiplyVec(F,w,w),E._offsetX=w[0]-n,E._offsetY=w[1]-C,E._dirty=!1}v.reset()},remove:function(){this._listener&&this.clearEventListener(),this.parentNode&&this.parentNode.removeChild(this)}});var g=function(c,u){for(var v,a=[],h=0,o=c.collection.length;o>h;h++){v=c.collection[h],u._intersectOne(v)&&a.push(v)}return a},q=function(A,y){for(var v,w,B=[],c=0,z=A.collection.length;z>c;c++){v=A.collection[c];for(var u=0,x=y.collection.length;x>u;u++){w=y.collection[u],v._intersectOne(w)&&B.push([v,w])}}return B},b=function(c,u){for(var v,a=[],h=0,o=c.collection.length;o>h;h++){v=c.collection[h],u._intersectStrictOne(v)&&a.push(v)}return a},m=function(A,y){for(var v,w,B=[],c=0,z=A.collection.length;z>c;c++){v=A.collection[c];for(var u=0,x=y.collection.length;x>u;u++){w=y.collection[u],v._intersectStrictOne(w)&&B.push([v,w])}}return B},d=function(a){return a instanceof f.Entity?g(this,a):"function"==typeof a&&a.collection?q(this,a):!1},j=function(a){return a instanceof f.Entity?b(this,a):"function"==typeof a&&a.collection?m(this,a):!1};f.Entity=f.Class.create(f.Node,{initialize:function(){var a=f.Core.instance;f.Node.call(this),this._rotation=0,this._scaleX=1,this._scaleY=1,this._touchEnabled=!0,this._clipping=!1,this._originX=null,this._originY=null,this._width=0,this._height=0,this._backgroundColor=null,this._debugColor="#0000ff",this._opacity=1,this._visible=!0,this._buttonMode=null,this._style={},this.__styleStatus={},this.compositeOperation=null,this.buttonMode=null,this.buttonPressed=!1,this.addEventListener("touchstart",function(){this.buttonMode&&(this.buttonPressed=!0,this.dispatchEvent(new f.Event(this.buttonMode+"buttondown")),a.changeButtonState(this.buttonMode,!0))}),this.addEventListener("touchend",function(){this.buttonMode&&(this.buttonPressed=!1,this.dispatchEvent(new f.Event(this.buttonMode+"buttonup")),a.changeButtonState(this.buttonMode,!1))}),this.enableCollection()},width:{get:function(){return this._width},set:function(a){this._width=a,this._dirty=!0}},height:{get:function(){return this._height},set:function(a){this._height=a,this._dirty=!0}},backgroundColor:{get:function(){return this._backgroundColor},set:function(a){this._backgroundColor=a}},debugColor:{get:function(){return this._debugColor},set:function(a){this._debugColor=a}},opacity:{get:function(){return this._opacity},set:function(a){this._opacity=parseFloat(a)}},visible:{get:function(){return this._visible},set:function(a){this._visible=a}},touchEnabled:{get:function(){return this._touchEnabled},set:function(a){this._touchEnabled=a,this._style.pointerEvents=a?"all":"none"}},intersect:function(a){return a instanceof f.Entity?this._intersectOne(a):"function"==typeof a&&a.collection?g(a,this):!1},_intersectOne:function(a){return this._dirty&&this._updateCoordinate(),a._dirty&&a._updateCoordinate(),this._offsetX<a._offsetX+a.width&&a._offsetX<this._offsetX+this.width&&this._offsetY<a._offsetY+a.height&&a._offsetY<this._offsetY+this.height},intersectStrict:function(a){return a instanceof f.Entity?this._intersectStrictOne(a):"function"==typeof a&&a.collection?b(a,this):!1},_intersectStrictOne:function(aQ){this._dirty&&this._updateCoordinate(),aQ._dirty&&aQ._updateCoordinate();var a5,aW,a1,aR,aS,ba,aV,a2,a7,a6,aP,aY,a4,bb,aO,a3,aX,az,aU,aK,aC,aj,aN,ap=this.getOrientedBoundingRect(),aM=aQ.getOrientedBoundingRect(),a8=ap.leftTop,ak=ap.rightTop,ao=ap.leftBottom,aE=ap.rightBottom,aB=aM.leftTop,aq=aM.rightTop,ar=aM.leftBottom,av=aM.rightBottom,al=a8[0],ai=a8[1],an=ak[0],aD=ak[1],aZ=ao[0],ad=ao[1],ay=aE[0],ac=aE[1],ah=aB[0],aw=aB[1],aJ=aq[0],ag=aq[1],aT=ar[0],a0=ar[1],ax=av[0],at=av[1],am=[an-al,aD-ai],ab=[ay-an,ac-aD],au=[aZ-ay,ad-ac],aG=[al-aZ,ai-ad],af=[aJ-ah,ag-aw],a9=[ax-aJ,at-ag],aa=[aT-ax,a0-at],aH=[ah-aT,aw-a0],aF=al+an+aZ+ay>>2,aL=ai+aD+ad+ac>>2,aA=ah+aJ+aT+ax>>2,aI=aw+ag+a0+at>>2;if(am[0]*(aI-ai)-am[1]*(aA-al)>0&&ab[0]*(aI-aD)-ab[1]*(aA-an)>0&&au[0]*(aI-ac)-au[1]*(aA-ay)>0&&aG[0]*(aI-ad)-aG[1]*(aA-aZ)>0){return !0}if(af[0]*(aL-aw)-af[1]*(aF-ah)>0&&a9[0]*(aL-ag)-a9[1]*(aF-aJ)>0&&aa[0]*(aL-at)-aa[1]*(aF-ax)>0&&aH[0]*(aL-a0)-aH[1]*(aF-aT)>0){return !0}for(a1=[a8,ak,aE,ao],aR=[aB,aq,av,ar],aS=[am,ab,au,aG],ba=[af,a9,aa,aH],a5=0;4>a5;a5++){for(aV=a1[a5],aP=aV[0],aY=aV[1],a7=aS[a5],aO=a7[0],a3=a7[1],aW=0;4>aW;aW++){if(a2=aR[aW],a4=a2[0],bb=a2[1],a6=ba[aW],aX=a6[0],az=a6[1],aC=aO*az-a3*aX,0!==aC&&(aU=a4-aP,aK=bb-aY,aj=(aU*a3-aK*aO)/aC,aN=(aU*az-aK*aX)/aC,aj>0&&1>aj&&aN>0&&1>aN)){return !0}}}return !1},within:function(a,c){this._dirty&&this._updateCoordinate(),a._dirty&&a._updateCoordinate(),null==c&&(c=(this.width+this.height+a.width+a.height)/4);var h;return c*c>(h=this._offsetX-a._offsetX+(this.width-a.width)/2)*h+(h=this._offsetY-a._offsetY+(this.height-a.height)/2)*h},scale:function(a,c){this._scaleX*=a,this._scaleY*=null!=c?c:a,this._dirty=!0},rotate:function(a){this._rotation+=a,this._dirty=!0},scaleX:{get:function(){return this._scaleX},set:function(a){this._scaleX=a,this._dirty=!0}},scaleY:{get:function(){return this._scaleY},set:function(a){this._scaleY=a,this._dirty=!0}},rotation:{get:function(){return this._rotation},set:function(a){this._rotation=a,this._dirty=!0}},originX:{get:function(){return this._originX},set:function(a){this._originX=a,this._dirty=!0}},originY:{get:function(){return this._originY},set:function(a){this._originY=a,this._dirty=!0}},enableCollection:function(){this.addEventListener("addedtoscene",this._addSelfToCollection),this.addEventListener("removedfromscene",this._removeSelfFromCollection),this.scene&&this._addSelfToCollection()},disableCollection:function(){this.removeEventListener("addedtoscene",this._addSelfToCollection),this.removeEventListener("removedfromscene",this._removeSelfFromCollection),this.scene&&this._removeSelfFromCollection()},_addSelfToCollection:function(){var a=this.getConstructor();a._collectionTarget.forEach(function(c){c.collection.push(this)},this)},_removeSelfFromCollection:function(){var a=this.getConstructor();a._collectionTarget.forEach(function(c){var h=c.collection.indexOf(this);-1!==h&&c.collection.splice(h,1)},this)},getBoundingRect:function(){var D=this.width||0,z=this.height||0,w=this._matrix,x=w[0]*D,E=w[1]*D,u=w[2]*z,C=w[3]*z,v=w[4],y=w[5],B=[v,x+v,u+v,x+u+v].sort(function(a,c){return a-c}),A=[y,E+y,C+y,E+C+y].sort(function(a,c){return a-c});return{left:B[0],top:A[0],width:B[3]-B[0],height:A[3]-A[0]}},getOrientedBoundingRect:function(){var A=this.width||0,y=this.height||0,v=this._matrix,w=v[0]*A,B=v[1]*A,c=v[2]*y,z=v[3]*y,u=v[4],x=v[5];return{leftTop:[u,x],rightTop:[w+u,B+x],leftBottom:[c+u,z+x],rightBottom:[w+c+u,B+z+x]}},getConstructor:function(){return Object.getPrototypeOf(this).constructor}});var l=function(c){if(!c._collective){var h=f.Class.getInheritanceTree(c),a=h.indexOf(f.Entity);c._collectionTarget=-1!==a?h.splice(0,a+1):[],c.intersect=d,c.intersectStrict=j,c.collection=[],c._collective=!0}};l(f.Entity),f.Entity._inherited=function(a){l(a)},f.Sprite=f.Class.create(f.Entity,{initialize:function(a,c){f.Entity.call(this),this.width=a,this.height=c,this._image=null,this._debugColor="#ff0000",this._frameLeft=0,this._frameTop=0,this._frame=0,this._frameSequence=[],this.addEventListener("enterframe",function(){if(0!==this._frameSequence.length){var e=this._frameSequence.shift();null===e?this._frameSequence=[]:(this._setFrame(e),this._frameSequence.push(e))}})},image:{get:function(){return this._image},set:function(a){if(a===k){throw Error("Assigned value on Sprite.image is undefined. Please double-check image path, and check if the image you want to use is preload before use.")}a!==this._image&&(this._image=a,this._setFrame(this._frame))}},frame:{get:function(){return this._frame},set:function(a){if(this._frame!==a){if(a instanceof Array){var c=a,h=c.shift();this._setFrame(h),c.push(h),this._frameSequence=c}else{this._setFrame(a),this._frameSequence=[],this._frame=a}}}},_setFrame:function(a){var c,h=this._image;null!=h&&(this._frame=a,c=0|h.width/this._width,this._frameLeft=(0|a%c)*this._width,this._frameTop=(0|a/c)*this._height%h.height)},width:{get:function(){return this._width},set:function(a){this._width=a,this._setFrame(this._frame),this._dirty=!0}},height:{get:function(){return this._height},set:function(a){this._height=a,this._setFrame(this._frame),this._dirty=!0}},cvsRender:function(D){var y,w,E,n,B,v,x,A=this._image,z=this._width,C=this._height;A&&0!==z&&0!==C&&(y=A.width,w=A.height,z>y||C>w?(D.fillStyle=f.Surface._getPattern(A),D.fillRect(0,0,z,C)):(E=A._element,n=this._frameLeft,B=Math.min(this._frameTop,w-C),v=Math.max(0.01,Math.min(y-n,z)),x=Math.max(0.01,Math.min(w-B,C)),D.drawImage(E,n,B,v,x,0,0,z,C)))},domRender:function(){return"ms"===f.ENV.VENDOR_PREFIX?function(){this._image&&(this._image._css?(this._style["background-image"]=this._image._css,this._style["background-position"]=-this._frameLeft+"px "+-this._frameTop+"px"):this._image._element)}:function(){this._image&&(this._image._css?(this._style["background-image"]=this._image._css,this._style["background-position"]=-this._frameLeft+"px "+-this._frameTop+"px"):this._image._element)}}()}),f.Label=f.Class.create(f.Entity,{initialize:function(a){f.Entity.call(this),this.text=a||"",this.width=300,this.font="14px serif",this.textAlign="left",this._debugColor="#ff0000"},width:{get:function(){return this._width},set:function(a){this._width=a,this._dirty=!0,this.updateBoundArea()}},text:{get:function(){return this._text},set:function(c){if(c=""+c,this._text!==c){this._text=c,c=c.replace(/<(br|BR) ?\/?>/g,"<br/>"),this._splitText=c.split("<br/>"),this.updateBoundArea();for(var h=0,o=this._splitText.length;o>h;h++){c=this._splitText[h];var a=this.getMetrics(c);this._splitText[h]={},this._splitText[h].text=c,this._splitText[h].height=a.height}}}},textAlign:{get:function(){return this._style["text-align"]},set:function(a){this._style["text-align"]=a,this.updateBoundArea()}},font:{get:function(){return this._style.font},set:function(a){this._style.font=a,this.updateBoundArea()}},color:{get:function(){return this._style.color},set:function(a){this._style.color=a}},cvsRender:function(H){var C,x,z,I,v,F,w,A,E,D=0,G=this.width;if(this._splitText){H.textBaseline="top",H.font=this.font,H.fillStyle=this.color||"#000000",x=H.measureText(" ").width,z=G/x;for(var y=0,B=this._splitText.length;B>y;y++){for(I=this._splitText[y],v=I.text,F=0;v.length>F+z||H.measureText(v.slice(F,F+z)).width>G;){for(w="",A=z,E=0;A>0;){G>H.measureText(w).width?(E+=A,w=v.slice(F,F+E)):(E-=A,w=v.slice(F,F+E)),A=0|A/2}H.fillText(w,0,D),D+=I.height-1,F+=E}w=v.slice(F,F+v.length),C="right"===this.textAlign?G-H.measureText(w).width:"center"===this.textAlign?(G-H.measureText(w).width)/2:0,H.fillText(w,C,D),D+=I.height-1}}},domRender:function(a){a.innerHTML!==this._text&&(a.innerHTML=this._text)},detectRender:function(a){a.fillRect(this._boundOffset,0,this._boundWidth,this._boundHeight)},updateBoundArea:function(){var a=this.getMetrics();this._boundWidth=a.width,this._boundHeight=a.height,this._boundOffset="right"===this.textAlign?this.width-this._boundWidth:"center"===this.textAlign?(this.width-this._boundWidth)/2:0},getMetrics:function(c){var h,o={};if(document.body){h=document.createElement("div");for(var a in this._style){"width"!==a&&"height"!==a&&(h.style[a]=this._style[a])}c=c||this._text,h.innerHTML=c.replace(/ /g,"&nbsp;"),h.style.whiteSpace="noWrap",h.style.lineHeight=1,document.body.appendChild(h),o.height=parseInt(getComputedStyle(h).height,10)+1,h.style.position="absolute",o.width=parseInt(getComputedStyle(h).width,10)+1,document.body.removeChild(h)}else{o.width=this.width,o.height=this.height}return o}}),f.Map=f.Class.create(f.Entity,{initialize:function(c,o){var a=f.Core.instance;f.Entity.call(this);var h=new f.Surface(a.width,a.height);this._surface=h;var n=h._element;n.style.position="absolute",f.ENV.RETINA_DISPLAY&&2===a.scale?(n.width=2*a.width,n.height=2*a.height,this._style.webkitTransformOrigin="0 0",this._style.webkitTransform="scale(0.5)"):(n.width=a.width,n.height=a.height),this._context=n.getContext("2d"),this._tileWidth=c||0,this._tileHeight=o||0,this._image=null,this._data=[[[]]],this._dirty=!1,this._tight=!1,this.touchEnabled=!1,this.collisionData=null,this._listeners.render=null,this.addEventListener("render",function(){if(this._dirty||null==this._previousOffsetX){this.redraw(0,0,a.width,a.height)}else{if(this._offsetX!==this._previousOffsetX||this._offsetY!==this._previousOffsetY){if(this._tight){var I=-this._offsetX,B=-this._offsetY,x=-this._previousOffsetX,J=-this._previousOffsetY,i=I-x+a.width,E=x-I+a.width,w=B-J+a.height,z=J-B+a.height;if(i>this._tileWidth&&E>this._tileWidth&&w>this._tileHeight&&z>this._tileHeight){var D,C,H,y,A,G;E>i?(D=0,H=x-I,A=i):(D=I-x,H=0,A=E),z>w?(C=0,y=J-B,G=w):(C=B-J,y=0,G=z),null==a._buffer&&(a._buffer=document.createElement("canvas"),a._buffer.width=this._context.canvas.width,a._buffer.height=this._context.canvas.height);var F=a._buffer.getContext("2d");this._doubledImage?(F.clearRect(0,0,2*A,2*G),F.drawImage(this._context.canvas,2*D,2*C,2*A,2*G,0,0,2*A,2*G),F=this._context,F.clearRect(2*H,2*y,2*A,2*G),F.drawImage(a._buffer,0,0,2*A,2*G,2*H,2*y,2*A,2*G)):(F.clearRect(0,0,A,G),F.drawImage(this._context.canvas,D,C,A,G,0,0,A,G),F=this._context,F.clearRect(H,y,A,G),F.drawImage(a._buffer,0,0,A,G,H,y,A,G)),0===H?this.redraw(A,0,a.width-A,a.height):this.redraw(0,0,a.width-A,a.height),0===y?this.redraw(0,G,a.width,a.height-G):this.redraw(0,0,a.width,a.height-G)}else{this.redraw(0,0,a.width,a.height)}}else{this.redraw(0,0,a.width,a.height)}}}this._previousOffsetX=this._offsetX,this._previousOffsetY=this._offsetY})},loadData:function(u){this._data=Array.prototype.slice.apply(arguments),this._dirty=!0,this._tight=!1;for(var x=0,z=this._data.length;z>x;x++){var h=0;u=this._data[x];for(var v=0,w=u.length;w>v;v++){for(var c=0,y=u[v].length;y>c;c++){u[v][c]>=0&&h++}}if(h/(u.length*u[0].length)>0.2){this._tight=!0;break}}},checkTile:function(o,w){if(0>o||o>=this.width||0>w||w>=this.height){return !1}var x=this._image.width,h=this._image.height,u=this._tileWidth||x,v=this._tileHeight||h;o=0|o/u,w=0|w/v;var c=this._data[0];return c[w][o]},hitTest:function(C,z){if(0>C||C>=this.width||0>z||z>=this.height){return !1}var w=this._image.width,x=this._image.height,D=this._tileWidth||w,u=this._tileHeight||x;if(C=0|C/D,z=0|z/u,null!=this.collisionData){return this.collisionData[z]&&!!this.collisionData[z][C]}for(var B=0,v=this._data.length;v>B;B++){var y,A=this._data[B];if(null!=A[z]&&null!=(y=A[z][C])&&y>=0&&(0|w/D)*(0|x/u)>y){return !0}}return !1},image:{get:function(){return this._image},set:function(A){var x=f.Core.instance;if(this._image=A,f.ENV.RETINA_DISPLAY&&2===x.scale){for(var v=new f.Surface(2*A.width,2*A.height),B=this._tileWidth||A.width,n=this._tileHeight||A.height,z=0|A.width/B,u=0|A.height/n,w=0;u>w;w++){for(var y=0;z>y;y++){v.draw(A,y*B,w*n,B,n,2*y*B,2*w*n,2*B,2*n)}}this._doubledImage=v}this._dirty=!0}},tileWidth:{get:function(){return this._tileWidth},set:function(a){this._tileWidth=a,this._dirty=!0}},tileHeight:{get:function(){return this._tileHeight},set:function(a){this._tileHeight=a,this._dirty=!0}},width:{get:function(){return this._tileWidth*this._data[0][0].length}},height:{get:function(){return this._tileHeight*this._data[0].length}},redraw:function(H,W,O,R){if(null!=this._image){var I,K,Z,M,S;this._doubledImage?(I=this._doubledImage,K=2*this._tileWidth,Z=2*this._tileHeight,M=2*-this._offsetX,S=2*-this._offsetY,H*=2,W*=2,O*=2,R*=2):(I=this._image,K=this._tileWidth,Z=this._tileHeight,M=-this._offsetX,S=-this._offsetY);var Y=0|I.width/K,X=0|I.height/Z,F=Math.max(0|(H+M)/K,0),Q=Math.max(0|(W+S)/Z,0),V=Math.ceil((H+M+O)/K),aa=Math.ceil((W+S+R)/Z),D=I._element,U=this._context;U.canvas,U.clearRect(H,W,O,R);for(var P=0,G=this._data.length;G>P;P++){var L=this._data[P],A=Math.min(V,L[0].length),J=Math.min(aa,L.length);for(W=Q;J>W;W++){for(H=F;A>H;H++){var x=L[W][H];if(x>=0&&Y*X>x){var B=x%Y*K,z=(0|x/Y)*Z;U.drawImage(D,B,z,K,Z,H*K-M,W*Z-S,K,Z)}}}}}},cvsRender:function(c){var h=f.Core.instance;if(0!==this.width&&0!==this.height){c.save(),c.setTransform(1,0,0,1,0,0);var a=this._context.canvas;c.drawImage(a,0,0,h.width,h.height),c.restore()}},domRender:function(){this._image&&(this._style["background-image"]=this._surface._css,this._style[f.ENV.VENDOR_PREFIX+"Transform"]="matrix(1, 0, 0, 1, 0, 0)")}}),f.Group=f.Class.create(f.Node,{initialize:function(){this.childNodes=[],f.Node.call(this),this._rotation=0,this._scaleX=1,this._scaleY=1,this._originX=null,this._originY=null,this.__dirty=!1,[f.Event.ADDED_TO_SCENE,f.Event.REMOVED_FROM_SCENE].forEach(function(a){this.addEventListener(a,function(c){this.childNodes.forEach(function(h){h.scene=this.scene,h.dispatchEvent(c)},this)})},this)},addChild:function(c){c.parentNode&&c.parentNode.removeChild(c),this.childNodes.push(c),c.parentNode=this;var h=new f.Event("childadded");if(h.node=c,h.next=null,this.dispatchEvent(h),c.dispatchEvent(new f.Event("added")),this.scene){c.scene=this.scene;var a=new f.Event("addedtoscene");c.dispatchEvent(a)}},insertBefore:function(c,o){c.parentNode&&c.parentNode.removeChild(c);var a=this.childNodes.indexOf(o);if(-1!==a){this.childNodes.splice(a,0,c),c.parentNode=this;var h=new f.Event("childadded");if(h.node=c,h.next=o,this.dispatchEvent(h),c.dispatchEvent(new f.Event("added")),this.scene){c.scene=this.scene;var n=new f.Event("addedtoscene");c.dispatchEvent(n)}}else{this.addChild(c)}},removeChild:function(c){var n;if(-1!==(n=this.childNodes.indexOf(c))){this.childNodes.splice(n,1),c.parentNode=null;var a=new f.Event("childremoved");if(a.node=c,this.dispatchEvent(a),c.dispatchEvent(new f.Event("removed")),this.scene){c.scene=null;var h=new f.Event("removedfromscene");c.dispatchEvent(h)}}},firstChild:{get:function(){return this.childNodes[0]}},lastChild:{get:function(){return this.childNodes[this.childNodes.length-1]}},rotation:{get:function(){return this._rotation},set:function(a){this._rotation=a,this._dirty=!0}},scaleX:{get:function(){return this._scaleX},set:function(a){this._scaleX=a,this._dirty=!0}},scaleY:{get:function(){return this._scaleY},set:function(a){this._scaleY=a,this._dirty=!0}},originX:{get:function(){return this._originX},set:function(a){this._originX=a,this._dirty=!0}},originY:{get:function(){return this._originY},set:function(a){this._originY=a,this._dirty=!0}},_dirty:{get:function(){return this.__dirty},set:function(a){if(a=!!a,this.__dirty=a,a){for(var c=0,h=this.childNodes.length;h>c;c++){this.childNodes[c]._dirty=!0}}}}}),f.Matrix=f.Class.create({initialize:function(){this.reset()},reset:function(){this.stack=[],this.stack.push([1,0,0,1,0,0])},makeTransformMatrix:function(y,J){var C=y._x,F=y._y,z=y.width||0,A=y.height||0,M=y._rotation||0,B="number"==typeof y._scaleX?y._scaleX:1,G="number"==typeof y._scaleY?y._scaleY:1,L=M*Math.PI/180,K=Math.cos(L),x=Math.sin(L),E="number"==typeof y._originX?y._originX:z/2,I="number"==typeof y._originY?y._originY:A/2,N=B*K,w=B*x,H=G*x,D=G*K;J[0]=N,J[1]=w,J[2]=-H,J[3]=D,J[4]=-N*E+H*I+C+E,J[5]=-w*E-D*I+F+I},multiply:function(I,C,x){var z=I[0],J=I[2],v=I[4],F=I[1],w=I[3],A=I[5],E=C[0],D=C[2],H=C[4],y=C[1],B=C[3],G=C[5];x[0]=z*E+J*y,x[1]=F*E+w*y,x[2]=z*D+J*B,x[3]=F*D+w*B,x[4]=z*H+J*G+v,x[5]=F*H+w*G+A},multiplyVec:function(D,z,w){var x=z[0],E=z[1],u=D[0],C=D[2],v=D[4],y=D[1],B=D[3],A=D[5];w[0]=u*x+C*E+v,w[1]=y*x+B*E+A}}),f.Matrix.instance=new f.Matrix,f.DetectColorManager=f.Class.create({initialize:function(c,h){this.reference=[],this.colorResolution=c||16,this.max=h||1,this.capacity=Math.pow(this.colorResolution,3);for(var o=1,a=this.capacity;a>o;o++){this.reference[o]=null}},attachDetectColor:function(a){var c=this.reference.indexOf(null);return -1===c&&(c=1),this.reference[c]=a,this._getColor(c)},detachDetectColor:function(a){var c=this.reference.indexOf(a);-1!==c&&(this.reference[c]=null)},_getColor:function(a){var c=this.colorResolution,h=c/this.max;return[parseInt(a/c/c%c,10)/h,parseInt(a/c%c,10)/h,parseInt(a%c,10)/h,1]},_decodeDetectColor:function(a){var c=this.colorResolution;return ~~(a[0]*c*c*c/256)+~~(a[1]*c*c/256)+~~(a[2]*c/256)},getSpriteByColor:function(a){return this.reference[this._decodeDetectColor(a)]}}),f.DomManager=f.Class.create({initialize:function(c,n){var a=f.Core.instance;this.layer=null,this.targetNode=c,"string"==typeof n?this.element=document.createElement(n):n instanceof HTMLElement&&(this.element=n),this.style=this.element.style,this.style.position="absolute",this.style[f.ENV.VENDOR_PREFIX+"TransformOrigin"]="0px 0px",a._debug&&(this.style.border="1px solid blue",this.style.margin="-1px");var h=this;this._setDomTarget=function(){h.layer._touchEventTarget=h.targetNode},this._attachEvent()},getDomElement:function(){return this.element},getDomElementAsNext:function(){return this.element},getNextManager:function(a){var c=this.targetNode.parentNode.childNodes.indexOf(a.targetNode);return c!==this.targetNode.parentNode.childNodes.length-1?this.targetNode.parentNode.childNodes[c+1]._domManager:null},addManager:function(c,h){var o;h&&(o=h.getDomElementAsNext());var a=c.getDomElement();a instanceof Array?a.forEach(function(e){o?this.element.insertBefore(e,o):this.element.appendChild(e)},this):o?this.element.insertBefore(a,o):this.element.appendChild(a),this.setLayer(this.layer)},removeManager:function(a){a instanceof f.DomlessManager?a._domRef.forEach(function(c){this.element.removeChild(c)},this):this.element.removeChild(a.element),this.setLayer(this.layer)},setLayer:function(c){this.layer=c;var o,r=this.targetNode;if(r.childNodes){for(var a=0,h=r.childNodes.length;h>a;a++){o=r.childNodes[a]._domManager,o&&o.setLayer(c)}}},render:function(u){var y=this.targetNode,n=f.Matrix.instance,w=n.stack,x=[];n.makeTransformMatrix(y,x),n.multiply(w[w.length-1],x,x),n.multiply(u,x,u),y._matrix=u;var c="number"==typeof y._originX?y._originX:y.width/2||0,z="number"==typeof y._originY?y._originY:y.height/2||0,v=[c,z];n.multiplyVec(x,v,v),y._offsetX=v[0]-c,y._offsetY=v[1]-z,!y.parentNode||y.parentNode instanceof f.Group||(y._offsetX+=y.parentNode._offsetX,y._offsetY+=y.parentNode._offsetY),y._dirty&&(this.style[f.ENV.VENDOR_PREFIX+"Transform"]="matrix("+x[0].toFixed(10)+","+x[1].toFixed(10)+","+x[2].toFixed(10)+","+x[3].toFixed(10)+","+x[4].toFixed(10)+","+x[5].toFixed(10)+")"),this.domRender()},domRender:function(){var c=this.targetNode;c._style||(c._style={}),c.__styleStatus||(c.__styleStatus={}),null!==c.width&&(c._style.width=c.width+"px"),null!==c.height&&(c._style.height=c.height+"px"),c._style.opacity=c._opacity,c._style["background-color"]=c._backgroundColor,c._visible!==k&&(c._style.display=c._visible?"block":"none"),"function"==typeof c.domRender&&c.domRender(this.element);var e;for(var a in c._style){e=c._style[a],c.__styleStatus[a]!==e&&null!=e&&(this.style.setProperty(a,""+e),c.__styleStatus[a]=e)}},_attachEvent:function(){f.ENV.TOUCH_ENABLED&&this.element.addEventListener("touchstart",this._setDomTarget,!0),this.element.addEventListener("mousedown",this._setDomTarget,!0)},_detachEvent:function(){f.ENV.TOUCH_ENABLED&&this.element.removeEventListener("touchstart",this._setDomTarget,!0),this.element.removeEventListener("mousedown",this._setDomTarget,!0)},remove:function(){this._detachEvent(),this.element=this.style=this.targetNode=null}}),f.DomlessManager=f.Class.create({initialize:function(a){this._domRef=[],this.targetNode=a},_register:function(a,c){var h=this._domRef.indexOf(c);a instanceof Array?-1===h?Array.prototype.push.apply(this._domRef,a):Array.prototype.splice.apply(this._domRef,[h,0].concat(a)):-1===h?this._domRef.push(a):this._domRef.splice(h,0,a)},getNextManager:function(a){var c=this.targetNode.parentNode.childNodes.indexOf(a.targetNode);return c!==this.targetNode.parentNode.childNodes.length-1?this.targetNode.parentNode.childNodes[c+1]._domManager:null},getDomElement:function(){var a=[];return this.targetNode.childNodes.forEach(function(c){a=a.concat(c._domManager.getDomElement())}),a},getDomElementAsNext:function(){if(this._domRef.length){return this._domRef[0]}var a=this.getNextManager(this);return a?a.element:null},addManager:function(c,n){var a=this.targetNode.parentNode;a&&(null===n&&(n=this.getNextManager(this)),a instanceof f.Scene?a._layers.Dom._domManager.addManager(c,n):a._domManager.addManager(c,n));var h=n?n.getDomElementAsNext():null;this._register(c.getDomElement(),h),this.setLayer(this.layer)},removeManager:function(a){var c,h=this._domRef.indexOf(a.element);-1!==h&&(c=this._domRef[h],c.parentNode.removeChild(c),this._domRef.splice(h,1)),this.setLayer(this.layer)},setLayer:function(c){this.layer=c;var o,r=this.targetNode;if(r.childNodes){for(var a=0,h=r.childNodes.length;h>a;a++){o=r.childNodes[a]._domManager,o&&o.setLayer(c)}}},render:function(u){var y=f.Matrix.instance,n=y.stack,w=this.targetNode,x=[];y.makeTransformMatrix(w,x),y.multiply(n[n.length-1],x,x),y.multiply(u,x,u),w._matrix=u;var c="number"==typeof w._originX?w._originX:w.width/2||0,z="number"==typeof w._originY?w._originY:w.height/2||0,v=[c,z];y.multiplyVec(x,v,v),w._offsetX=v[0]-c,w._offsetY=v[1]-z,n.push(x)},remove:function(){this._domRef=[],this.targetNode=null}}),f.DomLayer=f.Class.create(f.Group,{initialize:function(){var c=f.Core.instance;f.Group.call(this),this._touchEventTarget=null,this._element=document.createElement("div"),this._element.style.position="absolute",this._domManager=new f.DomManager(this,this._element),this._domManager.layer=this,this.width=c.width,this.height=c.height;var n=[f.Event.TOUCH_START,f.Event.TOUCH_MOVE,f.Event.TOUCH_END];n.forEach(function(e){this.addEventListener(e,function(i){this._scene&&this._scene.dispatchEvent(i)})},this);var a=function(s){var w=s.node,v=s.next,i=s.target,x=v?v._domManager:null;f.DomLayer._attachDomManager(w,a,h),i._domManager.addManager(w._domManager,x);var u=new f.Event(f.Event.RENDER);w._dirty=!0,i._domManager.layer._rendering(w,u)},h=function(i){var s=i.node,o=i.target;o._domManager.removeManager(s._domManager),f.DomLayer._detachDomManager(s,a,h)};this.addEventListener("childremoved",h),this.addEventListener("childadded",a)},width:{get:function(){return this._width},set:function(a){this._width=a,this._element.style.width=a+"px"}},height:{get:function(){return this._height},set:function(a){this._height=a,this._element.style.height=a+"px"}},addChild:function(c){this.childNodes.push(c),c.parentNode=this;var h=new f.Event("childadded");if(h.node=c,h.next=null,this.dispatchEvent(h),c.dispatchEvent(new f.Event("added")),this.scene){c.scene=this.scene;var a=new f.Event("addedtoscene");c.dispatchEvent(a)}},insertBefore:function(c,o){var a=this.childNodes.indexOf(o);if(-1!==a){this.childNodes.splice(a,0,c),c.parentNode=this;var h=new f.Event("childadded");if(h.node=c,h.next=o,this.dispatchEvent(h),c.dispatchEvent(new f.Event("added")),this.scene){c.scene=this.scene;var n=new f.Event("addedtoscene");c.dispatchEvent(n)}}else{this.addChild(c)}},_startRendering:function(){this.addEventListener("exitframe",this._onexitframe),this._onexitframe()},_stopRendering:function(){this.removeEventListener("exitframe",this._onexitframe),this._onexitframe()},_onexitframe:function(){this._rendering(this,new f.Event(f.Event.RENDER))},_rendering:function(n,v,h){var o;if(h||(h=[1,0,0,1,0,0]),n.dispatchEvent(v),n._domManager.render(h),n.childNodes){for(var u=0,c=n.childNodes.length;c>u;u++){o=n.childNodes[u],this._rendering(o,v,h.slice())}}n._domManager instanceof f.DomlessManager&&f.Matrix.instance.stack.pop(),n._dirty=!1},_determineEventTarget:function(){var a=this._touchEventTarget;return this._touchEventTarget=null,a===this?null:a}}),f.DomLayer._attachDomManager=function(n,v,h){var o;if(n._domManager||(n.addEventListener("childadded",v),n.addEventListener("childremoved",h),n._domManager=n instanceof f.Group?new f.DomlessManager(n):n._element?new f.DomManager(n,n._element):new f.DomManager(n,"div")),n.childNodes){for(var u=0,c=n.childNodes.length;c>u;u++){o=n.childNodes[u],f.DomLayer._attachDomManager(o,v,h),n._domManager.addManager(o._domManager,null)}}},f.DomLayer._detachDomManager=function(n,v,h){var o;if(n.removeEventListener("childadded",v),n.removeEventListener("childremoved",h),n.childNodes){for(var u=0,c=n.childNodes.length;c>u;u++){o=n.childNodes[u],n._domManager.removeManager(o._domManager,null),f.DomLayer._detachDomManager(o,v,h)}}n._domManager.remove(),delete n._domManager},f.CanvasLayer=f.Class.create(f.Group,{initialize:function(){var c=f.Core.instance;f.Group.call(this),this._cvsCache={matrix:[1,0,0,1,0,0],detectColor:"#000000"},this._cvsCache.layer=this,this._element=document.createElement("canvas"),this._element.style.position="absolute",this._element.style.left=this._element.style.top="0px",this._detect=document.createElement("canvas"),this._detect.style.position="absolute",this._lastDetected=0,this.context=this._element.getContext("2d"),this._dctx=this._detect.getContext("2d"),this._colorManager=new f.DetectColorManager(16,256),this.width=c.width,this.height=c.height;var n=[f.Event.TOUCH_START,f.Event.TOUCH_MOVE,f.Event.TOUCH_END];n.forEach(function(e){this.addEventListener(e,function(i){this._scene&&this._scene.dispatchEvent(i)})},this);var a=function(s){var v,u=s.node,i=s.target;v=i instanceof f.CanvasLayer?i._scene._layers.Canvas:i.scene._layers.Canvas,f.CanvasLayer._attachCache(u,v,a,h);var w=new f.Event(f.Event.RENDER);i._dirty&&i._updateCoordinate(),u._dirty=!0,f.Matrix.instance.stack.push(i._matrix),f.CanvasRenderer.instance.render(v.context,u,w),f.Matrix.instance.stack.pop(i._matrix)},h=function(o){var u,s=o.node,i=o.target;u=i instanceof f.CanvasLayer?i._scene._layers.Canvas:i.scene._layers.Canvas,f.CanvasLayer._detachCache(s,u,a,h)};this.addEventListener("childremoved",h),this.addEventListener("childadded",a)},width:{get:function(){return this._width},set:function(a){this._width=a,this._element.width=this._detect.width=a}},height:{get:function(){return this._height},set:function(a){this._height=a,this._element.height=this._detect.height=a}},addChild:function(c){this.childNodes.push(c),c.parentNode=this;var h=new f.Event("childadded");if(h.node=c,h.next=null,this.dispatchEvent(h),c.dispatchEvent(new f.Event("added")),this.scene){c.scene=this.scene;var a=new f.Event("addedtoscene");c.dispatchEvent(a)}},insertBefore:function(c,o){var a=this.childNodes.indexOf(o);if(-1!==a){this.childNodes.splice(a,0,c),c.parentNode=this;var h=new f.Event("childadded");if(h.node=c,h.next=o,this.dispatchEvent(h),c.dispatchEvent(new f.Event("added")),this.scene){c.scene=this.scene;var n=new f.Event("addedtoscene");c.dispatchEvent(n)}}else{this.addChild(c)}},_startRendering:function(){this.addEventListener("exitframe",this._onexitframe),this._onexitframe(new f.Event(f.Event.RENDER))},_stopRendering:function(){this.removeEventListener("render",this._onexitframe),this._onexitframe(new f.Event(f.Event.RENDER))},_onexitframe:function(){var c=f.Core.instance,h=this.context;h.clearRect(0,0,c.width,c.height);var a=new f.Event(f.Event.RENDER);f.CanvasRenderer.instance.render(h,this,a)},_determineEventTarget:function(a){return this._getEntityByPosition(a.x,a.y)},_getEntityByPosition:function(c,o){var a=f.Core.instance,h=this._dctx;this._lastDetected<a.frame&&(h.clearRect(0,0,this.width,this.height),f.CanvasRenderer.instance.detectRender(h,this),this._lastDetected=a.frame);var n=h.getImageData(c,o,1,1).data;return this._colorManager.getSpriteByColor(n)}}),f.CanvasLayer._attachCache=function(n,w,h,u){var v;if(n._cvsCache||(n._cvsCache={},n._cvsCache.matrix=[1,0,0,1,0,0],n._cvsCache.detectColor="rgba("+w._colorManager.attachDetectColor(n)+")",n.addEventListener("childadded",h),n.addEventListener("childremoved",u)),n.childNodes){for(var c=0,x=n.childNodes.length;x>c;c++){v=n.childNodes[c],f.CanvasLayer._attachCache(v,w,h,u)}}},f.CanvasLayer._detachCache=function(n,w,h,u){var v;if(n._cvsCache&&(w._colorManager.detachDetectColor(n),n.removeEventListener("childadded",h),n.removeEventListener("childremoved",u),delete n._cvsCache),n.childNodes){for(var c=0,x=n.childNodes.length;x>c;c++){v=n.childNodes[c],f.CanvasLayer._detachCache(v,w,h,u)}}},f.CanvasRenderer=f.Class.create({render:function(u,n,w){var x,e,y;if(u.save(),n.dispatchEvent(w),this.transform(u,n),(n._visible===k||n._visible)&&(x=n.width,e=n.height,n.compositeOperation&&(u.globalCompositeOperation=n.compositeOperation),u.globalAlpha="number"==typeof n._opacity?n._opacity:1,n._backgroundColor&&(u.fillStyle=n._backgroundColor,u.fillRect(0,0,x,e)),n.cvsRender&&n.cvsRender(u),f.Core.instance._debug&&n._debugColor&&(u.strokeStyle=n._debugColor,u.strokeRect(0,0,x,e)),n._clipping&&(u.beginPath(),u.rect(0,0,x,e),u.clip()),n.childNodes)){for(var v=0,z=n.childNodes.length;z>v;v++){y=n.childNodes[v],this.render(u,y,w)}}u.restore(),f.Matrix.instance.stack.pop()},detectRender:function(n,e){var v,w,c;if(e._visible===k||e._visible){if(v=e.width,w=e.height,n.save(),this.transform(n,e),n.fillStyle=e._cvsCache.detectColor,e._touchEnabled&&(e.detectRender?e.detectRender(n):n.fillRect(0,0,v,w)),e._clipping&&(n.beginPath(),n.rect(0,0,v,w),n.clip()),e.childNodes){for(var x=0,u=e.childNodes.length;u>x;x++){c=e.childNodes[x],this.detectRender(n,c)}}n.restore(),f.Matrix.instance.stack.pop()}},transform:function(u,y){var n,w,x,c,z=f.Matrix.instance,v=z.stack;y._dirty?(z.makeTransformMatrix(y,y._cvsCache.matrix),n=[],z.multiply(v[v.length-1],y._cvsCache.matrix,n),y._matrix=n,w="number"==typeof y._originX?y._originX:y._width/2||0,x="number"==typeof y._originY?y._originY:y._height/2||0,c=[w,x],z.multiplyVec(n,c,c),y._offsetX=c[0]-w,y._offsetY=c[1]-x,y._dirty=!1):n=y._matrix,v.push(n),u.setTransform.apply(u,n)}}),f.CanvasRenderer.instance=new f.CanvasRenderer,f.Scene=f.Class.create(f.Group,{initialize:function(){var a=f.Core.instance;f.Group.call(this),this.scene=this,this._backgroundColor=null,this._element=document.createElement("div"),this._element.style.position="absolute",this._element.style.overflow="hidden",this._element.style[f.ENV.VENDOR_PREFIX+"TransformOrigin"]="0 0",this._layers={},this._layerPriority=[],this.addEventListener(f.Event.CHILD_ADDED,this._onchildadded),this.addEventListener(f.Event.CHILD_REMOVED,this._onchildremoved),this.addEventListener(f.Event.ENTER,this._onenter),this.addEventListener(f.Event.EXIT,this._onexit);var c=this;this._dispatchExitframe=function(){var h;for(var e in c._layers){h=c._layers[e],h.dispatchEvent(new f.Event(f.Event.EXIT_FRAME))}},this.addEventListener(f.Event.CORE_RESIZE,this._oncoreresize),this._oncoreresize(a)},x:{get:function(){return this._x},set:function(a){this._x=a;for(var c in this._layers){this._layers[c].x=a}}},y:{get:function(){return this._y},set:function(a){this._y=a;for(var c in this._layers){this._layers[c].y=a}}},width:{get:function(){return this._width},set:function(a){this._width=a;for(var c in this._layers){this._layers[c].width=a}}},height:{get:function(){return this._height},set:function(a){this._height=a;for(var c in this._layers){this._layers[c].height=a}}},rotation:{get:function(){return this._rotation},set:function(a){this._rotation=a;for(var c in this._layers){this._layers[c].rotation=a}}},scaleX:{get:function(){return this._scaleX},set:function(a){this._scaleX=a;for(var c in this._layers){this._layers[c].scaleX=a}}},scaleY:{get:function(){return this._scaleY},set:function(a){this._scaleY=a;for(var c in this._layers){this._layers[c].scaleY=a}}},backgroundColor:{get:function(){return this._backgroundColor},set:function(a){this._backgroundColor=this._element.style.backgroundColor=a}},_oncoreresize:function(a){this._element.style.width=a.width+"px",this.width=a.width,this._element.style.height=a.height+"px",this.height=a.height,this._element.style[f.ENV.VENDOR_PREFIX+"Transform"]="scale("+a.scale+")";for(var c in this._layers){this._layers[c].dispatchEvent(a)}},addLayer:function(n,v){var h=f.Core.instance;if(!this._layers[n]){var o=new f[n+"Layer"];h.currentScene===this&&o._startRendering(),this._layers[n]=o;var u=o._element;if("number"==typeof v){var c=this._element.childNodes[v];c?this._element.insertBefore(u,c):this._element.appendChild(u),this._layerPriority.splice(v,0,n)}else{this._element.appendChild(u),this._layerPriority.push(n)}o._scene=this}},_determineEventTarget:function(c){for(var h,o,a=this._layerPriority.length-1;a>=0&&(h=this._layers[this._layerPriority[a]],!(o=h._determineEventTarget(c)));a--){}return o||(o=this),o},_onchildadded:function(c){var o,r,a=c.node,h=c.next;a._element?(o="Dom",r=1):(o="Canvas",r=0),this._layers[o]||this.addLayer(o,r),a._layer=this._layers[o],this._layers[o].insertBefore(a,h),a.parentNode=this},_onchildremoved:function(a){var c=a.node;c._layer.removeChild(c),c._layer=null},_onenter:function(){for(var a in this._layers){this._layers[a]._startRendering()}f.Core.instance.addEventListener("exitframe",this._dispatchExitframe)},_onexit:function(){for(var a in this._layers){this._layers[a]._stopRendering()}f.Core.instance.removeEventListener("exitframe",this._dispatchExitframe)}}),f.LoadingScene=f.Class.create(f.Scene,{initialize:function(){f.Scene.call(this),this.backgroundColor="#000";var n=0|0.4*this.width,w=0|0.05*this.width,h=0|0.03*n,u=new f.Sprite(n,w);u.disableCollection(),u.x=(this.width-n)/2,u.y=(this.height-w)/2;var v=new f.Surface(n,w);v.context.fillStyle="#fff",v.context.fillRect(0,0,n,w),v.context.fillStyle="#000",v.context.fillRect(h,h,n-2*h,w-2*h),u.image=v;var c=0,x=0;this.addEventListener("progress",function(a){c=1*(a.loaded/a.total)}),u.addEventListener("enterframe",function(){x*=0.9,x+=0.1*c,v.context.fillStyle="#fff",v.context.fillRect(h,0,(n-2*h)*x,w)}),this.addChild(u),this.addEventListener("load",function(a){var i=f.Core.instance;i.removeScene(i.loadingScene),i.dispatchEvent(a)})}}),f.CanvasScene=f.Class.create(f.Scene,{initialize:function(){f.Scene.call(this),this.addLayer("Canvas")},_determineEventTarget:function(a){var c=this._layers.Canvas._determineEventTarget(a);return c||(c=this),c},_onchildadded:function(a){var c=a.node,h=a.next;c._layer=this._layers.Canvas,this._layers.Canvas.insertBefore(c,h)},_onenter:function(){this._layers.Canvas._startRendering(),f.Core.instance.addEventListener("exitframe",this._dispatchExitframe)},_onexit:function(){this._layers.Canvas._stopRendering(),f.Core.instance.removeEventListener("exitframe",this._dispatchExitframe)}}),f.DOMScene=f.Class.create(f.Scene,{initialize:function(){f.Scene.call(this),this.addLayer("Dom")},_determineEventTarget:function(a){var c=this._layers.Dom._determineEventTarget(a);return c||(c=this),c},_onchildadded:function(a){var c=a.node,h=a.next;c._layer=this._layers.Dom,this._layers.Dom.insertBefore(c,h)},_onenter:function(){this._layers.Dom._startRendering(),f.Core.instance.addEventListener("exitframe",this._dispatchExitframe)},_onexit:function(){this._layers.Dom._stopRendering(),f.Core.instance.removeEventListener("exitframe",this._dispatchExitframe)}}),f.Surface=f.Class.create(f.EventTarget,{initialize:function(c,n){f.EventTarget.call(this);var a=f.Core.instance;this.width=c,this.height=n,this.context=null;var h="enchant-surface"+a._surfaceID++;document.getCSSCanvasContext?(this.context=document.getCSSCanvasContext("2d",h,c,n),this._element=this.context.canvas,this._css="-webkit-canvas("+h+")",this.context):document.mozSetImageElement?(this._element=document.createElement("canvas"),this._element.width=c,this._element.height=n,this._css="-moz-element(#"+h+")",this.context=this._element.getContext("2d"),document.mozSetImageElement(h,this._element)):(this._element=document.createElement("canvas"),this._element.width=c,this._element.height=n,this._element.style.position="absolute",this.context=this._element.getContext("2d"),f.ENV.CANVAS_DRAWING_METHODS.forEach(function(i){var o=this.context[i];this.context[i]=function(){o.apply(this,arguments),this._dirty=!0}},this))},getPixel:function(a,c){return this.context.getImageData(a,c,1,1).data},setPixel:function(o,w,x,h,u,v){var c=this.context.createImageData(1,1);c.data[0]=x,c.data[1]=h,c.data[2]=u,c.data[3]=v,this.context.putImageData(c,o,w)},clear:function(){this.context.clearRect(0,0,this.width,this.height)},draw:function(a){if(a=a._element,1===arguments.length){this.context.drawImage(a,0,0)}else{var c=arguments;c[0]=a,this.context.drawImage.apply(this.context,c)}},clone:function(){var a=new f.Surface(this.width,this.height);return a.draw(this),a},toDataURL:function(){var a=this._element.src;return a?"data:"===a.slice(0,5)?a:this.clone().toDataURL():this._element.toDataURL()}}),f.Surface.load=function(c,o,a){var h=new Image,n=Object.create(f.Surface.prototype,{context:{value:null},_css:{value:"url("+c+")"},_element:{value:h}});return f.EventTarget.call(n),a=a||function(){},n.addEventListener("load",o),n.addEventListener("error",a),h.onerror=function(){var e=new f.Event(f.Event.ERROR);e.message="Cannot load an asset: "+h.src,f.Core.instance.dispatchEvent(e),n.dispatchEvent(e)},h.onload=function(){n.width=h.width,n.height=h.height,n.dispatchEvent(new f.Event("load"))},h.src=c,n},f.Surface._staticCanvas2DContext=document.createElement("canvas").getContext("2d"),f.Surface._getPattern=function(a,c){return(!a._pattern||c)&&(a._pattern=this._staticCanvas2DContext.createPattern(a._element,"repeat")),a._pattern},p.Deferred?f.Deferred=p.Deferred:(f.Deferred=f.Class.create({initialize:function(){this._succ=this._fail=this._next=this._id=null,this._tail=this},next:function(a){var c=new f.Deferred;return c._succ=a,this._add(c)},error:function(a){var c=new f.Deferred;return c._fail=a,this._add(c)},_add:function(a){return this._tail._next=a,this._tail=a,this},call:function(c){for(var n,a=this;a&&!a._succ;){a=a._next}if(a instanceof f.Deferred){try{n=a._succ(c)}catch(h){return a.fail(h)}n instanceof f.Deferred?f.Deferred._insert(a,n):a._next instanceof f.Deferred&&a._next.call(n)}},fail:function(c){for(var n,a,h=this;h&&!h._fail;){h=h._next}if(!(h instanceof f.Deferred)){throw c instanceof Error?c:(a=Error("failed in Deferred"),a.arg=c,a)}n=h._fail(c),h.call(n)}}),f.Deferred._insert=function(a,c){a._next instanceof f.Deferred&&(c._next=a._next),a._next=c},f.Deferred.next=function(a){var c=(new f.Deferred).next(a);return c._id=setTimeout(function(){c.call()},0),c},f.Deferred.parallel=function(n){var v=new f.Deferred;v._id=setTimeout(function(){v.call()},0);var h=0,o=n instanceof Array?[]:{},u=new f.Deferred;for(var c in n){n.hasOwnProperty(c)&&(h++,function(a,i){a.next(function(e){h--,o[i]=e,0>=h&&u.call(o)}).error(function(e){u.fail(e)}),"number"==typeof a._id&&clearTimeout(a._id),a._id=setTimeout(function(){a.call()},0)}(n[c],c))}return h||(u._id=setTimeout(function(){u.call(o)},0)),v.next(function(){return u})}),f.DOMSound=f.Class.create(f.EventTarget,{initialize:function(){throw f.EventTarget.call(this),this.duration=0,Error("Illegal Constructor")},play:function(){this._element&&this._element.play()},pause:function(){this._element&&this._element.pause()},stop:function(){this.pause(),this.currentTime=0},clone:function(){var a;if(this._element instanceof Audio){a=Object.create(f.DOMSound.prototype,{_element:{value:this._element.cloneNode(!1)},duration:{value:this.duration}})}else{if(f.ENV.USE_FLASH_SOUND){return this}a=Object.create(f.DOMSound.prototype)}return f.EventTarget.call(a),a},currentTime:{get:function(){return this._element?this._element.currentTime:0},set:function(a){this._element&&(this._element.currentTime=a)}},volume:{get:function(){return this._element?this._element.volume:1},set:function(a){this._element&&(this._element.volume=a)}}}),f.DOMSound.load=function(w,u,A,n){if(null==u){var z=f.Core.findExt(w);u=z?"audio/"+z:""}u=u.replace("mp3","mpeg").replace("m4a","mp4"),n=n||function(){};var t=Object.create(f.DOMSound.prototype);f.EventTarget.call(t),t.addEventListener("load",A),t.addEventListener("error",n);var v=new Audio;if(!f.ENV.SOUND_ENABLED_ON_MOBILE_SAFARI&&"webkit"===f.ENV.VENDOR_PREFIX&&f.ENV.TOUCH_ENABLED){p.setTimeout(function(){t.dispatchEvent(new f.Event("load"))},0)}else{if(!f.ENV.USE_FLASH_SOUND&&v.canPlayType(u)){v.addEventListener("canplaythrough",function(){t.duration=v.duration,t.dispatchEvent(new f.Event("load"))},!1),v.src=w,v.load(),v.autoplay=!1,v.onerror=function(){var a=new f.Event(f.Event.ERROR);a.message="Cannot load an asset: "+v.src,f.Core.instance.dispatchEvent(a),t.dispatchEvent(a)},t._element=v}else{if("audio/mpeg"===u){var y=document.createElement("embed"),x="enchant-audio"+f.Core.instance._soundID++;y.width=y.height=1,y.name=x,y.src="sound.swf?id="+x+"&src="+w,y.allowscriptaccess="always",y.style.position="absolute",y.style.left="-1px",t.addEventListener("load",function(){Object.defineProperties(y,{currentTime:{get:function(){return y.getCurrentTime()},set:function(a){y.setCurrentTime(a)}},volume:{get:function(){return y.getVolume()},set:function(a){y.setVolume(a)}}}),t._element=y,t.duration=y.getDuration()}),f.Core.instance._element.appendChild(y),f.DOMSound[x]=t}else{p.setTimeout(function(){t.dispatchEvent(new f.Event("load"))},0)}}}return t},p.AudioContext=p.AudioContext||p.webkitAudioContext||p.mozAudioContext||p.msAudioContext||p.oAudioContext,f.WebAudioSound=f.Class.create(f.EventTarget,{initialize:function(){if(!p.webkitAudioContext){throw Error("This browser does not support WebAudio API.")}f.EventTarget.call(this),this.context=f.WebAudioSound.audioContext,this.src=this.context.createBufferSource(),this.buffer=null,this._volume=1,this._currentTime=0,this._state=0,this.connectTarget=f.WebAudioSound.destination},play:function(a){1!==this._state||a||this.src.disconnect(this.connectTarget),2!==this._state&&(this._currentTime=0);var c=this._currentTime,h=this.context;this.src=h.createBufferSource(),this.src.buffer=this.buffer,this.src.gain.value=this._volume,this.src.connect(this.connectTarget),this.src.noteGrainOn(0,c,this.buffer.duration-c-1.192e-7),this._startTime=h.currentTime-this._currentTime,this._state=1},pause:function(){var a=this.currentTime;a!==this.duration&&(this.src.noteOff(0),this._currentTime=a,this._state=2)},stop:function(){this.src.noteOff(0),this._state=0},clone:function(){var a=new f.WebAudioSound;return a.buffer=this.buffer,a},duration:{get:function(){return this.buffer?this.buffer.duration:0}},volume:{get:function(){return this._volume},set:function(a){a=Math.max(0,Math.min(1,a)),this._volume=a,this.src&&(this.src.gain.value=a)}},currentTime:{get:function(){return Math.max(0,Math.min(this.duration,this.src.context.currentTime-this._startTime))},set:function(a){this._currentTime=a,2!==this._state&&this.play(!1)}}}),f.WebAudioSound.load=function(A,x,v,B){function n(){var a=new f.Event(f.Event.ERROR);a.message="Cannot load an asset: "+A,f.Core.instance.dispatchEvent(a),u.dispatchEvent(a)}var z=(new Audio).canPlayType(x),u=new f.WebAudioSound;B=B||function(){},u.addEventListener(f.Event.LOAD,v),u.addEventListener(f.Event.ERROR,B);var w,y;return"maybe"===z||"probably"===z?(w=f.WebAudioSound.audioContext,y=new XMLHttpRequest,y.open("GET",A,!0),y.responseType="arraybuffer",y.onload=function(){w.decodeAudioData(y.response,function(a){u.buffer=a,u.dispatchEvent(new f.Event(f.Event.LOAD))},n)},y.onerror=n,y.send(null)):setTimeout(n,50),u},p.AudioContext&&(f.WebAudioSound.audioContext=new p.AudioContext,f.WebAudioSound.destination=f.WebAudioSound.audioContext.destination),f.Sound=p.AudioContext&&f.ENV.USE_WEBAUDIO?f.WebAudioSound:f.DOMSound,f.Easing={LINEAR:function(c,h,o,a){return o*c/a+h},SWING:function(c,h,o,a){return o*(0.5-Math.cos(c/a*Math.PI)/2)+h},QUAD_EASEIN:function(c,h,o,a){return o*(c/=a)*c+h},QUAD_EASEOUT:function(c,h,o,a){return -o*(c/=a)*(c-2)+h},QUAD_EASEINOUT:function(c,h,o,a){return 1>(c/=a/2)?o/2*c*c+h:-o/2*(--c*(c-2)-1)+h},CUBIC_EASEIN:function(c,h,o,a){return o*(c/=a)*c*c+h},CUBIC_EASEOUT:function(c,h,o,a){return o*((c=c/a-1)*c*c+1)+h},CUBIC_EASEINOUT:function(c,h,o,a){return 1>(c/=a/2)?o/2*c*c*c+h:o/2*((c-=2)*c*c+2)+h},QUART_EASEIN:function(c,h,o,a){return o*(c/=a)*c*c*c+h},QUART_EASEOUT:function(c,h,o,a){return -o*((c=c/a-1)*c*c*c-1)+h},QUART_EASEINOUT:function(c,h,o,a){return 1>(c/=a/2)?o/2*c*c*c*c+h:-o/2*((c-=2)*c*c*c-2)+h},QUINT_EASEIN:function(c,h,o,a){return o*(c/=a)*c*c*c*c+h},QUINT_EASEOUT:function(c,h,o,a){return o*((c=c/a-1)*c*c*c*c+1)+h},QUINT_EASEINOUT:function(c,h,o,a){return 1>(c/=a/2)?o/2*c*c*c*c*c+h:o/2*((c-=2)*c*c*c*c+2)+h},SIN_EASEIN:function(c,h,o,a){return -o*Math.cos(c/a*(Math.PI/2))+o+h},SIN_EASEOUT:function(c,h,o,a){return o*Math.sin(c/a*(Math.PI/2))+h},SIN_EASEINOUT:function(c,h,o,a){return -o/2*(Math.cos(Math.PI*c/a)-1)+h},CIRC_EASEIN:function(c,h,o,a){return -o*(Math.sqrt(1-(c/=a)*c)-1)+h},CIRC_EASEOUT:function(c,h,o,a){return o*Math.sqrt(1-(c=c/a-1)*c)+h},CIRC_EASEINOUT:function(c,h,o,a){return 1>(c/=a/2)?-o/2*(Math.sqrt(1-c*c)-1)+h:o/2*(Math.sqrt(1-(c-=2)*c)+1)+h},ELASTIC_EASEIN:function(o,w,x,h,u,v){if(0===o){return w}if(1===(o/=h)){return w+x}v||(v=0.3*h);var c;return !u||Math.abs(x)>u?(u=x,c=v/4):c=v/(2*Math.PI)*Math.asin(x/u),-(u*Math.pow(2,10*(o-=1))*Math.sin((o*h-c)*2*Math.PI/v))+w},ELASTIC_EASEOUT:function(o,w,x,h,u,v){if(0===o){return w}if(1===(o/=h)){return w+x}v||(v=0.3*h);var c;return !u||Math.abs(x)>u?(u=x,c=v/4):c=v/(2*Math.PI)*Math.asin(x/u),u*Math.pow(2,-10*o)*Math.sin((o*h-c)*2*Math.PI/v)+x+w},ELASTIC_EASEINOUT:function(o,w,x,h,u,v){if(0===o){return w}if(2===(o/=h/2)){return w+x}v||(v=h*0.3*1.5);var c;return !u||Math.abs(x)>u?(u=x,c=v/4):c=v/(2*Math.PI)*Math.asin(x/u),1>o?-0.5*u*Math.pow(2,10*(o-=1))*Math.sin((o*h-c)*2*Math.PI/v)+w:0.5*u*Math.pow(2,-10*(o-=1))*Math.sin((o*h-c)*2*Math.PI/v)+x+w},BOUNCE_EASEOUT:function(c,h,o,a){return 1/2.75>(c/=a)?o*7.5625*c*c+h:2/2.75>c?o*(7.5625*(c-=1.5/2.75)*c+0.75)+h:2.5/2.75>c?o*(7.5625*(c-=2.25/2.75)*c+0.9375)+h:o*(7.5625*(c-=2.625/2.75)*c+0.984375)+h},BOUNCE_EASEIN:function(c,n,a,h){return a-f.Easing.BOUNCE_EASEOUT(h-c,0,a,h)+n},BOUNCE_EASEINOUT:function(c,n,a,h){return h/2>c?0.5*f.Easing.BOUNCE_EASEIN(2*c,0,a,h)+n:0.5*f.Easing.BOUNCE_EASEOUT(2*c-h,0,a,h)+0.5*a+n},BACK_EASEIN:function(c,o,a,e,h){return h===k&&(h=1.70158),a*(c/=e)*c*((h+1)*c-h)+o},BACK_EASEOUT:function(c,o,a,e,h){return h===k&&(h=1.70158),a*((c=c/e-1)*c*((h+1)*c+h)+1)+o},BACK_EASEINOUT:function(c,o,a,e,h){return h===k&&(h=1.70158),1>(c/=e/2)?a/2*c*c*(((h*=1.525)+1)*c-h)+o:a/2*((c-=2)*c*(((h*=1.525)+1)*c+h)+2)+o},EXPO_EASEIN:function(c,h,o,a){return 0===c?h:o*Math.pow(2,10*(c/a-1))+h},EXPO_EASEOUT:function(c,h,o,a){return c===a?h+o:o*(-Math.pow(2,-10*c/a)+1)+h},EXPO_EASEINOUT:function(c,h,o,a){return 0===c?h:c===a?h+o:1>(c/=a/2)?o/2*Math.pow(2,10*(c-1))+h:o/2*(-Math.pow(2,-10*--c)+2)+h}},f.ActionEventTarget=f.Class.create(f.EventTarget,{initialize:function(){f.EventTarget.apply(this,arguments)},dispatchEvent:function(c){var o;this.node?(o=this.node,c.target=o,c.localX=c.x-o._offsetX,c.localY=c.y-o._offsetY):this.node=null,null!=this["on"+c.type]&&this["on"+c.type].call(o,c);var r=this._listeners[c.type];if(null!=r){r=r.slice();for(var a=0,h=r.length;h>a;a++){r[a].call(o,c)}}}}),f.Timeline=f.Class.create(f.EventTarget,{initialize:function(a){f.EventTarget.call(this),this.node=a,this.queue=[],this.paused=!1,this.looped=!1,this.isFrameBased=!0,this._parallel=null,this._activated=!1,this.addEventListener(f.Event.ENTER_FRAME,this.tick)},_deactivateTimeline:function(){this._activated&&(this._activated=!1,this.node.removeEventListener("enterframe",this._nodeEventListener))},_activateTimeline:function(){this._activated||this.paused||(this.node.addEventListener("enterframe",this._nodeEventListener),this._activated=!0)},setFrameBased:function(){this.isFrameBased=!0},setTimeBased:function(){this.isFrameBased=!1},next:function(c){var a,e=this.queue.shift();if(a=new f.Event("actionend"),a.timeline=this,e.dispatchEvent(a),0===this.queue.length){return this._activated=!1,this.node.removeEventListener("enterframe",this._nodeEventListener),k}if(this.looped?(a=new f.Event("removedfromtimeline"),a.timeline=this,e.dispatchEvent(a),e.frame=0,this.add(e)):(a=new f.Event("removedfromtimeline"),a.timeline=this,e.dispatchEvent(a)),c>0||this.queue[0]&&0===this.queue[0].time){var h=new f.Event("enterframe");h.elapsed=c,this.dispatchEvent(h)}},tick:function(c){if(!this.paused&&this.queue.length>0){var n=this.queue[0];if(0===n.frame){var a;a=new f.Event("actionstart"),a.timeline=this,n.dispatchEvent(a)}var h=new f.Event("actiontick");h.timeline=this,h.elapsed=this.isFrameBased?1:c.elapsed,n.dispatchEvent(h)}},add:function(c){if(!this._activated){var h=this;this._nodeEventListener=function(e){h.dispatchEvent(e)},this.node.addEventListener("enterframe",this._nodeEventListener),this._activated=!0}this._parallel?(this._parallel.actions.push(c),this._parallel=null):this.queue.push(c),c.frame=0;var a=new f.Event("addedtotimeline");return a.timeline=this,c.dispatchEvent(a),a=new f.Event("actionadded"),a.action=c,this.dispatchEvent(a),this},action:function(a){return this.add(new f.Action(a))},tween:function(a){return this.add(new f.Tween(a))},clear:function(){var c=new f.Event("removedfromtimeline");c.timeline=this;for(var h=0,a=this.queue.length;a>h;h++){this.queue[h].dispatchEvent(c)}return this.queue=[],this._deactivateTimeline(),this},skip:function(a){var c=new f.Event("enterframe");for(this.isFrameBased?c.elapsed=1:(c.elapsed=a,a=1);a--;){this.dispatchEvent(c)}return this},pause:function(){return this.paused||(this.paused=!0,this._deactivateTimeline()),this},resume:function(){return this.paused&&(this.paused=!1,this._activateTimeline()),this},loop:function(){return this.looped=!0,this},unloop:function(){return this.looped=!1,this},delay:function(a){return this.add(new f.Action({time:a})),this},wait:function(){return this},then:function(a){var c=this;return this.add(new f.Action({onactiontick:function(){a.call(c.node)},time:0})),this},exec:function(a){this.then(a)},cue:function(a){var c=0;for(var h in a){a.hasOwnProperty(h)&&(this.delay(h-c),this.then(a[h]),c=h)}},repeat:function(a,c){return this.add(new f.Action({onactiontick:function(){a.call(this)},time:c})),this},and:function(){var a=this.queue.pop();if(a instanceof f.ParallelAction){this._parallel=a,this.queue.push(a)}else{var c=new f.ParallelAction;c.actions.push(a),this.queue.push(c),this._parallel=c}return this},or:function(){return this},doAll:function(){return this},waitAll:function(){return this},waitUntil:function(a){var c=this;return this.add(new f.Action({onactionstart:a,onactiontick:function(){a.call(this)&&c.next()}})),this},fadeTo:function(a,c,h){return this.tween({opacity:a,time:c,easing:h}),this},fadeIn:function(a,c){return this.fadeTo(1,a,c)},fadeOut:function(a,c){return this.fadeTo(0,a,c)},moveTo:function(c,h,o,a){return this.tween({x:c,y:h,time:o,easing:a})},moveX:function(a,c,h){return this.tween({x:a,time:c,easing:h})},moveY:function(a,c,h){return this.tween({y:a,time:c,easing:h})},moveBy:function(c,h,o,a){return this.tween({x:function(){return this.x+c},y:function(){return this.y+h},time:o,easing:a})},hide:function(){return this.then(function(){this.opacity=0})},show:function(){return this.then(function(){this.opacity=1})},removeFromScene:function(){return this.then(function(){this.scene.removeChild(this)})},scaleTo:function(a,c,h){return"number"==typeof h?this.tween({scaleX:arguments[0],scaleY:arguments[1],time:arguments[2],easing:arguments[3]}):this.tween({scaleX:a,scaleY:a,time:c,easing:h})},scaleBy:function(a,c,h){return"number"==typeof h?this.tween({scaleX:function(){return this.scaleX*arguments[0]},scaleY:function(){return this.scaleY*arguments[1]},time:arguments[2],easing:arguments[3]}):this.tween({scaleX:function(){return this.scaleX*a},scaleY:function(){return this.scaleY*a},time:c,easing:h})},rotateTo:function(a,c,h){return this.tween({rotation:a,time:c,easing:h})},rotateBy:function(a,c,h){return this.tween({rotation:function(){return this.rotation+a},time:c,easing:h})}}),f.Action=f.Class.create(f.ActionEventTarget,{initialize:function(c){f.ActionEventTarget.call(this),this.time=null,this.frame=0;for(var h in c){c.hasOwnProperty(h)&&null!=c[h]&&(this[h]=c[h])}var a=this;this.timeline=null,this.node=null,this.addEventListener(f.Event.ADDED_TO_TIMELINE,function(e){a.timeline=e.timeline,a.node=e.timeline.node,a.frame=0}),this.addEventListener(f.Event.REMOVED_FROM_TIMELINE,function(){a.timeline=null,a.node=null,a.frame=0}),this.addEventListener(f.Event.ACTION_TICK,function(i){var n=a.time-(a.frame+i.elapsed);null!=a.time&&0>=n?(a.frame=a.time,i.timeline.next(-n)):a.frame+=i.elapsed})}}),f.ParallelAction=f.Class.create(f.Action,{initialize:function(a){f.Action.call(this,a),this.timeline,this.node,this.actions=[],this.endedActions=[];var c=this;this.addEventListener(f.Event.ACTION_START,function(h){for(var o=0,e=c.actions.length;e>o;o++){c.actions[o].dispatchEvent(h)}}),this.addEventListener(f.Event.ACTION_TICK,function(n){var h,o,u={next:function(){var i=c.actions[h];c.actions.splice(h--,1),o=c.actions.length,c.endedActions.push(i);var s=new f.Event("actionend");s.timeline=this,i.dispatchEvent(s),s=new f.Event("removedfromtimeline"),s.timeline=this,i.dispatchEvent(s)}},e=new f.Event("actiontick");for(e.timeline=u,e.elapsed=n.elapsed,h=0,o=c.actions.length;o>h;h++){c.actions[h].dispatchEvent(e)}0===c.actions.length&&n.timeline.next()}),this.addEventListener(f.Event.ADDED_TO_TIMELINE,function(h){for(var o=0,e=c.actions.length;e>o;o++){c.actions[o].dispatchEvent(h)}}),this.addEventListener(f.Event.REMOVED_FROM_TIMELINE,function(){this.actions=this.endedActions,this.endedActions=[]})}}),f.Tween=f.Class.create(f.Action,{initialize:function(c){var a={},e={};f.Action.call(this,c),null==this.easing&&(this.easing=function(r,s,u,o){return u*r/o+s});var h=this;this.addEventListener(f.Event.ACTION_START,function(){var o=["frame","time","callback","onactiontick","onactionstart","onactionend"];for(var r in c){if(c.hasOwnProperty(r)){var i;i="function"==typeof c[r]?c[r].call(h.node):c[r],-1===o.indexOf(r)&&(a[r]=h.node[r],e[r]=i)}}}),this.addEventListener(f.Event.ACTION_TICK,function(o){var r=0===h.time?1:h.easing(Math.min(h.time,h.frame+o.elapsed),0,1,h.time)-h.easing(h.frame,0,1,h.time);for(var i in e){if(e.hasOwnProperty(i)){if(this[i]===k){continue}h.node[i]+=(e[i]-a[i])*r,1e-7>Math.abs(h.node[i])&&(h.node[i]=0)}}})}})})(window);var layer1=[[0,0,5,5,5,5,5,5,0,0,0,0,0,0,0,0,0,0,0,0,0,5,4,4,4,4],[0,0,5,2,2,2,2,5,0,0,0,0,0,0,0,0,0,0,0,0,0,2,4,4,4,4],[0,0,5,1,1,1,1,5,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4],[0,0,5,1,1,1,1,5,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4],[0,0,5,5,1,1,5,5,0,0,0,0,0,0,0,0,0,0,0,0,0,5,5,5,5,5],[0,0,2,2,1,1,2,2,0,0,5,5,5,5,5,5,5,5,5,0,0,2,2,2,2,2],[0,0,0,0,0,0,0,0,0,0,5,2,2,2,2,2,2,2,5,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,5,1,1,1,1,1,1,1,5,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,5,1,1,1,1,1,1,1,5,0,0,0,0,0,0,0],[0,0,5,5,5,5,5,0,0,0,5,1,1,1,1,1,1,1,5,0,0,0,0,0,0,0],[0,0,5,2,2,2,5,0,0,0,5,5,5,1,1,1,5,5,5,0,0,0,0,0,0,0],[0,0,5,1,1,1,5,0,0,0,2,2,2,1,1,1,2,2,2,0,0,5,5,5,5,5],[0,0,5,1,1,1,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,2,2,2,5],[0,0,5,5,1,1,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,1,1,5],[0,0,2,2,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,5],[0,0,0,0,0,0,0,0,0,0,0,0,0,5,5,5,5,5,0,0,0,1,1,1,1,5],[0,0,0,0,0,0,0,0,0,0,0,0,0,5,2,2,2,5,0,0,0,5,1,1,1,5],[0,0,0,0,0,0,0,0,0,0,0,0,0,5,2,2,2,5,0,0,0,5,5,5,5,5],[0,0,5,5,5,5,0,0,5,5,0,0,0,2,3,3,3,5,0,0,0,2,2,2,2,2],[0,0,5,2,2,2,0,0,2,5,0,0,0,2,3,3,3,5,0,0,0,0,0,0,0,0],[0,0,5,1,1,1,1,1,1,5,0,0,0,3,3,3,3,5,0,0,0,0,0,0,0,0],[0,0,5,1,1,1,1,1,1,5,0,0,0,3,3,3,3,5,5,5,5,5,5,0,0,0],[0,0,5,1,1,1,1,1,1,5,0,0,0,5,3,3,3,2,2,2,2,2,5,0,0,0],[0,0,5,5,5,5,5,5,5,5,0,0,0,5,3,3,3,2,2,2,2,2,5,0,0,0],[0,0,2,2,2,2,2,2,2,2,0,0,0,5,3,3,3,3,3,3,3,3,5,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,5,3,3,3,3,3,3,3,3,5,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,5,5,5,5,5,5,5,5,5,5,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,2,2,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,2,2,0,0,0]];var collision=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,1],[1,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,5,5,5,5,1],[1,0,1,1,0,0,1,1,0,0,5,5,5,5,5,5,5,5,5,0,0,2,2,2,2,1],[1,0,0,0,0,0,0,0,0,0,5,2,2,2,2,2,2,2,5,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,5,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,5,0,0,0,0,0,0,1],[1,0,5,5,5,5,5,0,0,0,5,0,0,0,0,0,0,0,5,0,0,0,0,0,0,1],[1,0,5,2,2,2,5,0,0,0,5,5,5,0,0,0,5,5,5,0,0,0,0,0,0,1],[1,0,5,0,0,0,5,0,0,0,2,2,2,0,0,0,2,2,2,0,0,5,5,5,5,1],[1,0,5,0,0,0,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,2,2,2,1],[1,0,5,5,0,0,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,1],[1,0,2,2,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,5,5,5,5,5,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,5,2,2,2,5,0,0,0,5,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,5,2,2,2,5,0,0,0,5,5,5,5,1],[1,0,5,5,5,5,0,0,5,5,0,0,0,2,0,0,0,5,0,0,0,2,2,2,2,1],[1,0,5,2,2,2,0,0,2,5,0,0,0,2,0,0,0,5,0,0,0,0,0,0,0,1],[1,0,5,0,0,0,0,0,0,5,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,1],[1,0,5,0,0,0,0,0,0,5,0,0,0,0,0,0,0,5,5,5,5,5,5,0,0,1],[1,0,5,0,0,0,0,0,0,5,0,0,0,5,0,0,0,2,2,2,2,2,5,0,0,1],[1,0,5,5,5,5,5,5,5,5,0,0,0,5,0,0,0,2,2,2,2,2,5,0,0,1],[1,0,2,2,2,2,2,2,2,2,0,0,0,5,0,0,0,0,0,0,0,0,5,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,0,5,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,5,5,5,5,5,5,5,5,5,5,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,2,2,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]];enchant();window.onload=function(){var y=0;var m=1;var u=2;var c=3;var f=200;var d=210;var j=8;var e=32;var h=32;var i=-1;var x=-1;var g=-999;var v=-999;var w=0,o=0,p=0,k=0,s=2,q=1,t=50;var z=new Core(640,640);z.fps=16;z.preload("background.png","spritesheet.png");z.onload=function(){var M=new Map(32,32);M.image=z.assets["background.png"];M.loadData(layer1);M.collisionData=collision;var O=new Sprite(64,64);O.image=z.assets["spritesheet.png"];O.x=f-h;O.y=d-e;O.frame=11;O.toX=O.x;O.toY=O.y;O.dir=c;O.anim=[6,5,7,5,9,8,10,8,1,0,2,0,3,11,4,11];O.hasRecStore=function(){z.rootScene.removeChild(I);var V=S.indexOf(I);S.splice(V,1);p-=400;o+=0.0009;w+=200;t+=1000;B.dialogue.question="How are you today boss? Anything I can help you with, boss?";B.dialogue.a=["Youre fine where you are. Nice day we are having.",n];B.dialogue.b=["Who is the dumb one now? You are fired! get out of here, rent-a-cop",function(){z.rootScene.removeChild(B);var W=S.indexOf(B);S.splice(W,1)}];T.dialogue.question="So many records";T.dialogue.a=["Mine. All Mine",n];delete T.dialogue.b};O.buyLabel=function(){var Y=["After all that work you are left with about $3.50<br> and a single Creed record.<br>The End","You spend all your money on hookers and blow","You get laid off","Your board of directors decides <br>they have had enough","You party with rock stars","You make tons of money doing next to nothing","You become CEO of Corporate Label Inc"];for(var Z=0,X=Y.length;Z<X;Z++){var V=new Scene();var W=new Label(Y[Z]);V.backgroundColor="black";W.font="20px monospace";W.textAlign="center";W.color="rgb(128,128,128)";W.width=z.width-40;W.y=200;V.addChild(W);z.pushScene(V);if(Z!==0){V.addEventListener(Event.TOUCH_START,function(){z.popScene()})}}};O.sellCollection=function(){var Y=["You go outside and enjoy life<br>The End","You are happy","You realize today is the first day<br> of the rest of your life","You join collectors anonymous","You notice how much more to life there<br> is than collecting things","You sell your records"];for(var Z=0,X=Y.length;Z<X;Z++){var V=new Scene();var W=new Label(Y[Z]);V.backgroundColor="black";W.font="20px monospace";W.textAlign="center";W.color="rgb(128,128,128)";W.width=z.width-40;W.y=200;V.addChild(W);z.pushScene(V);if(Z!==0){V.addEventListener(Event.TOUCH_START,function(){z.popScene()})}}};var L=new Sprite(64,64);L.frame=20;var I=new Sprite(64,64);I.frame=21;var D=new Sprite(64,64);D.frame=14;var P=new Sprite(64,64);P.frame=17;var J=new Sprite(64,64);J.frame=18;var H=new Sprite(64,64);H.frame=16;var U=new Sprite(64,64);U.frame=19;var N=new Sprite(64,64);N.frame=23;var Q=new Sprite(64,64);Q.frame=12;var B=new Sprite(64,64);B.frame=24;var T=new Sprite(64,64);T.frame=22;var A=new Sprite(64,64);A.frame=15;var S=[L,I,D,P,J,H,U,B,N,Q,T,A];var R=S.length;for(var K=0;K<R;K++){S[K].hit=false;S[K].image=z.assets["spritesheet.png"]}L.allowanceFunc=function(){if(Math.random()<0.2){k+=0.00003;L.dialogue.question="Honey, I hope you aren't spending all your money on those darn<br>records";L.dialogue.allowance=["Sure thing mom.",n];z.pushScene(z.makeDialogueScene({question:"Sure, dear. You deserve it",a:["Thanks mom!!",n]}))}else{var V=["REM","Iron Maiden","The Clash","Wu Tang","Black Sabbath"];var W=["Justin Bieber","Winger","Stryper","ICP"];z.pushScene(z.makeDialogueScene({question:"Sorry honey, maybe you can get a job somewhere?",a:["I bet "+r(V)+" never had to get jobs",n],b:["Now Way! I'd rather listen to "+r(W),n]}))}};L.recordFunc=function(){if(Math.random()<0.4){w++;delete L.dialogue.record;z.pushScene(z.makeDialogueScene({question:"Sure, dear. You deserve to rock! Here is a "+b()+" record",a:["Thanks mom!!",n]}))}else{z.pushScene(z.makeDialogueScene({question:"Sorry dear, I read records are detrimental to both the health and<br>morals",a:["That's only if you listen to them backwards",n],b:["Inconceivable!!",n]}))}};L.dialogue={question:"Hello dear.",allowance:["Hi mom, can I have an allowance?",L.allowanceFunc],record:["Hi mom, can you buy me a record?",L.recordFunc]};I.recCost=1.2;I.recMultiplier=Math.floor(w/5)||1;I.shopliftCost=1;I.buy=function(){if(p<I.shopliftCost*I.recCost*I.recMultiplier){z.pushScene(z.makeDialogueScene({question:"Sorry, you cannot afford any records from us",b:["Capitalist pig-dog!!",n],a:["The best things in life are free... But I want the money",n]}))}else{var V;I.recMultiplier=Math.floor(w/5)||1;if(w<100){V="We got a great sale going on right now. Only "+(Math.floor(100*I.shopliftCost*I.recCost))/100+" dollars per <br>record!"}else{V="Good records are hard to find. We are selling them for "+(Math.floor(I.shopliftCost*I.recCost))/100+" dollars per record"}z.pushScene(z.makeDialogueScene({question:V,a:["Great I will buy "+I.recMultiplier+" "+b()+" records!",function(){p-=I.shopliftCost*I.recMultiplier*I.recCost;w+=I.recMultiplier;I.recCost+=0.3}],b:["Cool I will buy "+(I.recMultiplier*2)+" "+b()+" records!",function(){p-=2*I.shopliftCost*I.recMultiplier*I.recCost;w+=2*I.recMultiplier;I.recCost+=0.3}],c:["Too expensive, maybe another time.",n]}))}};I.sell=function(){I.recMultiplier=Math.floor(w/5)||1;if(w<1){z.pushScene(z.makeDialogueScene({question:"We both know you only have mp3s, and no records",b:["This store sucks!",n]}))}else{z.pushScene(z.makeDialogueScene({question:"Ok, lets look at your posuer collection... hmm..<br>I will give you "+(Math.floor(100*I.recCost/(2*I.shopliftCost))+1)/100+" dollars per record.",a:["Neat I will sell "+I.recMultiplier+" "+b()+" records!",function(){p+=I.recMultiplier*(1+I.recCost)/(I.shopliftCost*2);w-=I.recMultiplier;I.recCost-=0.2}],b:["OK I will sell "+(I.recMultiplier*2)+" "+b()+" records!",function(){p+=I.recMultiplier*(1+I.recCost)*I.shopliftCost;w-=2*I.recMultiplier;I.recCost-=0.2}],c:["I need better prices than those. Maybe another time.",n]}))}};I.work=function(){var aa=12;for(var W=0;W<aa;W++){var Z=new Scene();var V=new Label("<br> Working hard, please wait "+W+" seconds");V.font="24px monospace";V.color="rgb(255,200,0)";V.backgroundColor="rgb(0,0,0)";V.width=z.width;V.height=z.height;var X=new Label("Wage<br><br>Slave");X.font="98px monospace";X.textAlign="center";X.color=(W%2===1)?"red":"yellow";X.y=300;X.x=100;Z.addChild(V);Z.addChild(X);z.pushScene(Z)}var Y=setInterval(function(){z.popScene();aa--;if(aa<0){clearInterval(Y)}},1000)};I.job=function(){I.recMultiplier=Math.floor(w/5)||1;z.pushScene(z.makeDialogueScene({question:"I will pay you "+(Math.floor(400*I.recMultiplier))/100+"  records or "+(Math.floor(500*I.recCost))/100+" dollars to work right now",r:["I will work for records",function(){I.work();w+=4*I.recMultiplier}],m:["I will work for money",function(){I.work();p+=5*I.recCost}],n:["I dont want to be a wage slave",n]}))};I.buyShop=function(){z.pushScene(z.makeDialogueScene({question:"You punk kid! You got more records than I do. This store does not<br>make any money, but a lot of people trade in their old records.<br>Fine, I will sell for 300 dollars.",y:["Sucker, you got a deal",O.hasRecStore],n:["JK, LOL, not interested",n]}))};I.dialogue={question:"Welcome to If They Only Knew Records, the best record store <br>around",b:["I want to buy some records",I.buy],s:["I want to sell some records",I.sell],j:["I want a job",I.job]};D.quest=false;D.recCost=1;D.swap=function(){z.pushScene(z.makeDialogueScene({question:"Mondo cool! If you give me a box of "+Math.floor(40*D.recCost)+" records, I can wheel and <br>deal and slowly increase your collection",y:["Off the hook! its a deal",function(){if(w>=(40*D.recCost)){w-=(40*D.recCost);o+=(0.0001);D.recCost+=0.4}else{a()}}],n:["Bummer. I dont really want to do that",n]}))};D.tookRecord=function(){D.quest=true;U.dialogue.a=["Your boyfriend told asked me to give you this record",U.gotRecord];D.dialogue.question="You deliver that record to my lady yet?";D.dialogue.y=["Working on it",n];delete D.dialogue.n};D.tip=function(){z.pushScene(z.makeDialogueScene({question:"Wicked fresh! have a Killed by Death record for your troubles",a:["Hella tight! Thanks homie",n]}));J.killed();D.dialogue.question="What is up brah?";D.dialogue.y=["I got some records I want to swap",D.swap];D.dialogue.n=["Just wanted to tell you my new favorite band is "+b(),n]};D.dialogue={question:"Hey, I run a booth at the swap meet here. Can you deliver this <br>Barry White record to my girlfriend at the record label for me?",y:["Sure, I can do that for you",D.tookRecord],n:["I dont have the time",n]};U.gotRecord=function(){z.pushScene(z.makeDialogueScene({question:"I looove Barry White! Thanks a bunch, I will call my boyfriend <br>right now and thank him!",a:["No problemo, lady.",n]}));U.dialogue.question="Sorry kid, no time to talk to the likes of you. Only rock stars<br>and millionaires are allowed in here.";U.dialogue.a=["AKA wimps and posers!",n];D.dialogue.question="Hey kid, what can I do you for?";D.dialogue.y=["Your girlfriend loved the record you sent her",D.tip]};U.dialogue={question:"Welcome to Corporate Label Inc. We make big money! We dont have<br>time for you right now.",a:["Only sellouts hang out here anyway",n]};P.cost=1;P.soldDrums=function(){if(w>=80){w-=80;delete P.dialogue.b;N.dialogue.question="Oi, sweet skins. Welcome to the band.";N.dialogue.n=["Lets play a show! I wanna rock!",N.playFirstShow]}else{a()}};P.sellDrums=function(){z.pushScene(z.makeDialogueScene({question:"Yeah, I can hook you up. A drum kit will cost you 80 high<br>quality prog rock records",y:["Deal! Prog rock is for burnt out hippies anyway",P.soldDrums],n:["Give up my precious records? no way",n]}))};P.buySpace=function(){z.pushScene(z.makeDialogueScene({question:"Pay me "+Math.floor(5*P.cost)+" dollars and you <br>can keep "+Math.floor(w/6)+" records, here",y:["It is a deal",function(){if(p>=(5*P.cost)){t+=(Math.floor(w/6));p-=Math.floor(5*P.cost);P.cost++}else{a()}}],n:["Your prices are crazy. No way!",n]}))};P.dialogue={question:"Welcome to Junk in a Truck Storage. You can buy storage space<br>for your records here. Sometimes I have stuff for sale from<br>abandoned storage units",y:["I need more room for records.",P.buySpace],n:["No thanks, I can probably find more space to keep my records in<br>my room at home. I bet mom wont mind.",n]};N.showsPlays=1;N.playShow=function(){var aa=15,Y=[];for(var W=0;W<aa;W++){var Z=new Scene();var V=new Label("<br>you make money playing shows. Shows also<br>increase your fame, increasing your<br>merch income. Please wait while we circle pit");V.font="24px monospace";V.color="rgb(255,200,0)";V.backgroundColor="rgb(0,0,0)";V.width=z.width;V.height=z.height;Y[W]=new Sprite(64,64);Y[W].scale(2,2);Y[W].frame=3+(W%2);Y[W].x=300;Y[W].y=320;Y[W].image=z.assets["spritesheet.png"];Z.addChild(V);Z.addChild(Y[W]);z.pushScene(Z)}var X=setInterval(function(){z.popScene();aa--;if(aa<0){clearInterval(X)}},1000);p+=2*N.showsPlays;N.showsPlays++};N.playFirstShow=function(){N.dialogue.question="Our last show was so intense! I think our band might be the <br>shape of punk to come. We even made "+(2*N.showsPlays)+" dollars";H.dialogue.question="Hey, I really liked your show";H.dialogue.a=["Hey, Thanks! I like your hair",H.flirt];H.dialogue.b=["Oh, now that I am in a band you want to talk to me?",H.lessflirt];N.dialogue.n=["Lets play a show right now",N.playShow];N.playShow();H.isMoney&&(k+=0.0005)};N.giveKilled=function(){z.pushScene(z.makeDialogueScene({question:"Here you go, and remember, punx not dead! oi!",t:["Thanks. Oi oi.",J.killed]}));delete N.dialogue.g;N.dialogue.question="We are covering Los Crudos at our next show!"};N.canJoin=function(){z.pushScene(z.makeDialogueScene({question:"You know, my band, The "+b()+"s do need a drummer. <br>Can you play?",n:["I dont have a drum set. But I bet I can get one from somewhere!",function(){z.pushScene(z.makeDialogueScene({question:"Get a drum set and you can totally rock with us.",a:["I am so excited I can't control my fingers, I can't controll my <br>brain",n]}))}]}));N.dialogue.question="Any luck with those drums yet?";N.dialogue.n=["Im still looking for the drums",n];P.dialogue.b=["Hey, Do you have a drum set I can buy?",P.sellDrums]};N.gaveRecs=(function(){var W=0;return function V(){W++;if(W>4){N.dialogue.question="Oi. Thanks for all the records. Anything I can do for you?";N.dialogue.g=["Do you have any Killed by Death records I can have?",N.giveKilled];N.dialogue.n=["I want to join your band!",N.canJoin];N.dialogue.m=["Up the punx, oi!",n]}}})();N.gaveRecsTalk=function(){var V=["Keep on rockin in the free world!","I love music","I wanna rock and roll all night...","Thank you","You're not as nerdy as you look","Thrash, kill destroy!"];z.pushScene(z.makeDialogueScene({question:V[Math.floor(Math.random()*6)],a:["I hope you enjoy it",n]}))};N.dialogue={question:"Oi! My band is playing a show soon, you should come check us<br>out. I hear you have a bunch of records. Let me have one.",g:["Uhh, ok. You can have one of my records",function(){if(w>=1){w--;N.gaveRecs();N.gaveRecsTalk()}else{a()}}],n:["What? Get your own records, you bum.",n],};H.isPrez=function(){z.pushScene(z.makeDialogueScene({question:"This is so cool! I love your band! I cant wait for the next show",a:["Thanks for supporting our band. You are really helping us bring in more money",n]}));H.dialogue.question="I love running your merch! You should play more shows. We should <br>also hang out sometime";delete H.dialogue.a;H.dialogue.b=["Yeah, that would be cool, but first I want to get a few more <br>records",n];k+=0.002;H.isMoney=true};H.isNotPrez=function(){H.dialogue.question="Hey, so maybe I can sell merch for you now?";H.dialogue.a=["Yeah, I think that is a good idea.",H.isPrez];H.dialogue.b=["hmm, yeah, I dont think so.",n]};H.flirt=function(){z.pushScene(z.makeDialogueScene({question:"Thanks! Hey does your band need a merch lady? <br>I can help get cash and records for you by selling and<br>trading your merch",a:["Totally! It would be really cool to have you work with us",H.isPrez],b:["No thanks. We do pretty well already. <br>But you should come check out our next show.",H.idNotPrez]}))};H.lessflirt=function(){z.pushScene(z.makeDialogueScene({question:"Hey, come on, I always thought you were cute. What if I offered to sell merch for your band? I can help you trade records even outside of shows.",a:["Yeah, it would be cool to make some extra records. You got a deal",H.isPrez],b:["You were too good to talk to me before, now my band is too good for you. No thanks.",H.isNotPrez]}))};H.denied=function(){z.pushScene(z.makeDialogueScene({question:"Leave me alone, you record dork.",a:["Oh, excuse me.",n],b:["Was it something I said or something I did? <br>Did my words not come out right?",n]}));H.dialogue.question="I got no time for scrubs. Your records dont impress me.";H.dialogue.a=["Ouch, I guess every rose has its thorn",n]};H.dialogue={question:"...",a:["Hi, how's it going?",H.denied]};J.flipCost=2;J.flip=function(){z.pushScene(z.makeDialogueScene({question:"Neat, give me "+J.flipCost*60+" records and I will flip them",y:["Yeah, I think of this as an investment, here you go",function(){if(w>=J.flipCost*60){w-=J.flipCost*60;o+=0.0005;J.flipCost+=1}else{a()}}],a:["No thanks, the internet is for porn not flipping records",n]}))};J.questDone=function(){z.pushScene(z.makeDialogueScene({question:"Hah! I bet. Do you like Math rock? I can flip records for you on<br>the internet. Give me some to start with and I will<br>multiply them",a:["Yeah, that sounds good. Flip me some records, dude.",J.flip],b:["Maybe some other time. I dont really trust computers",n]}));J.dialogue.question="Hey d00d, want me to flip some records for you on the net?";J.dialogue.a=["Yeah, I want to get more records!",J.flip];J.dialogue.b=["Not right now.",n]};J.killed=(function(){var W=0;return function V(){W++;if(W>2){J.dialogue.question="Sweet, you found all the Killed by Death records I wanted";J.dialogue.a=["It was easy.",J.questDone]}}})();J.dialogue={question:"I trade records on the Internet. Only rare ones. I might be<br>willing to work for you if you can find me 3 Killed by<br>Death records.",a:["I bet I can find them all",function(){J.dialogue.question="You still have not found all the Killed by Death records, huh?";delete J.dialogue.b}],b:["Nerd, find your own records!",n]};B.dialogue={question:"Best not be trying to steal anything, you dumb kid.",a:["I would not dream of it",n]};T.killed=true;T.stole=function(){if((Math.random()*3.5)<I.shopliftCost){I.shopliftCost+=0.3;if(I.shopliftCost>3.2){I.shopliftCost=3}z.pushScene(z.makeDialogueScene({question:"Son, you ain't no Pretty Boy Floyd. You just got caught stealing.<br>We are taking a fifth of your recrods away",a:["Instead of going to jail I am willing to pay<br>Here, take my records!",function(){w-=w/5}]}));B.dialogue.question="Seems like shoplifters have to pay more for records around here<br>Stupid kid, dont try to steal anything else!";B.dialogue.a=["I was framed!",n]}else{var V="";if(T.killed){V=" And a Killed by Death record!";J.killed();T.killed=false}z.pushScene(z.makeDialogueScene({question:"Shoplifters of the world unite, you just got away with 15 <br>free records"+V,a:["I fought the law, and I won!",function(){w+=15}]}))}};T.dialogue={question:"Look at all these records!",a:["I bet I could take a few without anyone noticing. <br>I will take some!",T.stole],b:["One day these will all be mine. If I want any right now I need to<br>buy them from the owner",n]};Q.choseDoor=function(){var W,X,V=10;if(Math.random()*3<1){X="Awesome, the space you chose to clean had a bunch of records! you<br>just gained "+V+" records!";W="All due to a positive mental attitude";w+=V}else{X="Shoot, you did not find anything other than lint and <br>hairballs in the storage space. Better luck next time";W="That's what it's like workin for the Man every night and day"}z.pushScene(z.makeDialogueScene({question:X,b:["I want to clean some more!",Q.clean],a:[W,n]}))};Q.clean=function(){var Y=new Scene();Y.backgroundColor="black";var W=new Label("Select a storage space to clean");W.font="20px monospace";W.textAlign="center";W.color="rgb(0,255,0)";Y.addChild(W);var V=[];var X=116;function Z(){return function(){z.popScene();Q.choseDoor()}}for(K=0;K<3;K++){V[K]=new Sprite(64,64);V[K].scale(2,2);V[K].image=z.assets["spritesheet.png"];V[K].frame=13;V[K].x=X;X+=140;V[K].y=320;Y.addChild(V[K]);V[K].addEventListener(Event.TOUCH_START,Z())}z.pushScene(Y)};Q.dialogue={question:"Do you want to help clean out storage units? We<br>cannot afford to  pay you.",y:["Sure, I can help you out and I might find something cool in there",Q.clean],n:["No thanks, I dont work for free.",n]};A.dialogue={question:"Cool, a "+l()+" record!",take:["I'm adding this to my collection!",function(){w++;z.rootScene.removeChild(A);S.pop()}],leave:["I always hated this record",function(){z.rootScene.removeChild(A);S.pop()}]};var C=new Label("Records: "+w);C.x=10;C.y=10;C.color="black";var G=new Label("Storage Space: "+t);G.x=10;G.y=24;G.color="black";var F=new Label("Money:   "+p);F.x=10;F.y=38;F.color="black";C.addEventListener(Event.ENTER_FRAME,function(V){w+=o*V.elapsed;if(w>t){w=t}this.text="Records: "+(Math.round(w*100)/100)});G.addEventListener(Event.ENTER_FRAME,function(){this.text="Storage Space: "+t});F.addEventListener(Event.ENTER_FRAME,function(V){p+=k*V.elapsed;this.text="Money:   "+(Math.round(p*100)/100)});function E(){if(w>t){L.dialogue.question="There is no more room in this house for records! You have to <br>find somewhere else to keep them!"}else{L.dialogue.question="Honey, I dont like this record obsession. Why not try cookie <br>collecting instead?"}if(p>400){I.dialogue.j=["I want to buy your shop!",I.buyShop]}else{I.dialogue.j=["Can I do some work around here?",I.job]}if(p>10000||w>10000){U.dialogue.question="Wow, you sure have done well for yourself. How can Corporate <br>Label Inc. help you?";if(p>1400){U.dialogue.c=["I want to buy this record label and become CEO!",O.buyLabel]}else{delete U.dialogue.c}if(w>1400){U.dialogue.b=["I want to sell my whole record collection",O.sellCollection]}else{delete U.dialogue.b}}}O.addEventListener(Event.ENTER_FRAME,function(){L.x=90+M.x;L.y=50+M.y;I.x=355+M.x;I.y=210+M.y;T.x=505+M.x;T.y=206+M.y;A.x=724+M.x;A.y=640+M.y;D.x=680+M.x;D.y=50+M.y;U.x=530+M.x;U.y=750+M.y;P.x=670+M.x;P.y=440+M.y;N.x=224+M.x;N.y=610+M.y;H.x=110+M.x;H.y=608+M.y;J.x=90+M.x;J.y=330+M.y;Q.x=740+M.x;Q.y=400+M.y;B.x=450+M.x;B.y=280+M.y;if(O.y>O.toY){O.dir=u;if(Math.abs(O.y-O.toY)<j){O.y=O.toY}else{if(O.y<z.width/3&&M.y<0&&(M.hitTest(O.x+h+Math.abs(M.x),O.y+e+Math.abs(M.y))===false)){M.y+=j;O.toY+=j}else{O.y-=j;if(M.hitTest(O.x+h+Math.abs(M.x),O.y+e+Math.abs(M.y))){O.y+=j}}}}else{if(O.y<O.toY){O.dir=c;if(Math.abs(O.y-O.toY)<j){O.y=O.toY}else{if(O.y>z.height-(z.height/3)&&M.height+M.y>z.height&&(M.hitTest(O.x+h+Math.abs(M.x),O.y+(e*2)+Math.abs(M.y))===false)){M.y-=j;O.toY-=j}else{O.y+=j;if(M.hitTest(O.x+h+Math.abs(M.x),O.y+(e*2)+Math.abs(M.y))){O.y-=j}}}}}if(O.x>O.toX){O.dir=y;if(Math.abs(O.x-O.toX)<j){O.x=O.toX}else{if(O.x<(z.width/3)&&M.x<0&&(M.hitTest(O.x+(h/2)+Math.abs(M.x),O.y+e*2+Math.abs(M.y))===false)){M.x+=j;O.toX+=j}else{O.x-=j;if(M.hitTest(O.x+(h/2)+Math.abs(M.x),O.y+(e*2)+Math.abs(M.y))){O.x+=j}}}}else{if(O.x<O.toX){O.dir=m;if(Math.abs(O.x-O.toX)<j){O.x=O.toX}else{if(O.x>z.width-(z.width/3)&&M.width+M.x>z.width&&(M.hitTest(O.x+(h+16)+Math.abs(M.x),O.y+e*2+Math.abs(M.y))===false)){M.x-=j;O.toX-=j}else{O.x+=j;if(M.hitTest(O.x+(h+16)+Math.abs(M.x),O.y+e*2+Math.abs(M.y))){O.x-=j}}}}}var V=S.length;for(var W=0;W<V;W++){var X=S[W];if(O.within(X,16)){if(!X.hit){E();z.pushScene(z.makeDialogueScene(X.dialogue));X.hit=true}}else{X.hit=false}}if(O.x==i&&x==O.y&&M.x==g&&M.y==v){O.age=1}O.frame=O.anim[O.dir*4+(O.age%4)];i=O.x;x=O.y;g=M.x;v=M.y});z.rootScene.addEventListener(Event.TOUCH_START,function(V){O.toX=V.x-h;O.toY=V.y-e});z.rootScene.addChild(M);for(K=0;K<R;K++){z.rootScene.addChild(S[K])}z.rootScene.addChild(O);z.rootScene.addChild(C);z.rootScene.addChild(F);z.rootScene.addChild(G);s=(Math.floor(w/20)+2);q=1+Math.floor(w/10)};z.makeDialogueScene=function(A){var F=new Scene();var E=400;var H=48;var I=Object.keys(A);var G=[];G[0]=new Label(A.question);G[0].font="16px monospace";G[0].color="rgb(255,255,255)";G[0].backgroundColor="rgba(0,0,0,0.8)";G[0].y=400;G[0].width=z.width;G[0].height=z.height-400;F.addChild(G[0]);for(var D=1,C=I.length;D<C;D++){G[D]=new Label(A[I[D]][0]);G[D].font="16px monospace";G[D].color="rgb(255,255,0)";G[D].y=(E+=H);G[D].width=z.width;G[D].height=z.height-400;F.addChild(G[D])}function B(J){return function(){z.popScene();A[I[J]][1]()}}for(var D=1;D<I.length;D++){G[D].addEventListener(Event.TOUCH_START,B(D))}return F};var n=function(){};function b(){var B=["Liqued","Rancid","Squishy","Brown","Swampy","Edgy","Monotone"];var A=["Toast","Brain","Bone","Animal","Worm","Graphic"];return r(B)+" "+r(A)}function l(){var A=["Billy Bragg","Refused","Doc Watson","Minor Threat","The Coup","Crass","Wlochaty"];return r(A)}function r(A){return A[Math.floor(Math.random()*A.length)]}function a(){z.pushScene(z.makeDialogueScene({question:"Quit trying to cheat the system, you cannot afford that!",a:["Sorry, sometimes I dont know how to math",n]}))}z.start()};